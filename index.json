[{"content":"ç»ˆäºåœ¨è¿™ä¸ªå‘¨æ—¥çš„æ™šä¸Šï¼ŒæŠŠè¿™ä¸ªåšå®¢æ­å»ºå®Œæˆäº†ï¼Œå¸Œæœ›ä¹‹åå¯ä»¥å…»æˆå†™åšå®¢çš„ä¹ æƒ¯\n","date":"16 July 2023","permalink":"/diary/day01/","section":"Diaries","summary":"ç»ˆäºåœ¨è¿™ä¸ªå‘¨æ—¥çš„æ™šä¸Šï¼ŒæŠŠè¿™ä¸ªåšå®¢æ­å»ºå®Œæˆäº†ï¼Œå¸Œæœ›ä¹‹åå¯ä»¥å…»æˆå†™åšå®¢çš„ä¹ æƒ¯","title":"2023å¹´7æœˆ16æ—¥"},{"content":"","date":"16 July 2023","permalink":"/diary/","section":"Diaries","summary":"","title":"Diaries"},{"content":"This is a demo site built entirely using Blowfish.\n","date":"16 July 2023","permalink":"/","section":"Welcome to Blowfish! ğŸ‰","summary":"This is a demo site built entirely using Blowfish.","title":"Welcome to Blowfish! ğŸ‰"},{"content":"","date":"15 July 2023","permalink":"/linux/test/","section":"Linuxes","summary":"","title":"First Blog"},{"content":" This is title # è¿™ä¸ªåŒ…æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†æ–‡ä»¶è¿›è¡Œæ‰“åŒ…å’Œè§£åŒ…ï¼Œè¦æ˜¯ç†Ÿæ‚‰ Linux ä¸‹çš„ tar å‘½ä»¤è¿™ä¸ªå°±å¾ˆå¥½ç†è§£äº†ã€‚ ä¸»è¦æ˜¯é€šè¿‡ tar.Reader è¯»å– tar åŒ…ï¼Œé€šè¿‡ tar.Writer å†™å…¥ tar åŒ…ï¼Œåœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­å†è®¾ç½®ä¸€ä¸‹å¤´ï¼Œè¯¦ç»†çš„è¿‡ç¨‹ä»¥ç¤ºä¾‹çš„æ–¹å¼è¿›è¡Œå±•ç¤ºï¼Œå¯ä»¥æŸ¥çœ‹ä»£ç é‡Œé¢çš„æ³¨é‡Šã€‚\nå‚è€ƒï¼š\næ ‡å‡†åº“ tar ä¸­æ–‡æ–‡æ¡£\næ ‡å‡†åº“ tar å®˜æ–¹æ–‡æ¡£\nå•ä¸ªæ–‡ä»¶æ“ä½œ # è¿™ä¸ªéå¸¸ç®€å•ï¼Œå°±æ˜¯è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿›è¡Œæ‰“åŒ…åŠè§£åŒ…æ“ä½œå³å¯ã€‚\nå•ä¸ªæ–‡ä»¶æ‰“åŒ… # ä» /etc/passwd ä¸‹å¤åˆ¶äº†ä¸€ä¸ª passwd æ–‡ä»¶åˆ°å½“å‰ç›®å½•ä¸‹ï¼Œç”¨æ¥åšå‹ç¼©æµ‹è¯•ã€‚ä»€ä¹ˆæ–‡ä»¶éƒ½æ˜¯å¯ä»¥çš„ï¼Œè‡ªå·±éšæ„å†™ä¸€ä¸ªä¹Ÿè¡Œã€‚è¿™é‡Œçš„ç¤ºä¾‹ä¸»è¦ä¸ºäº†è¯´æ˜ tar ï¼Œæ²¡æœ‰å¤„ç†è·¯å¾„ï¼Œæ‰€ä»¥è¿‡ç¨‹å…¨éƒ¨å‡è®¾æ˜¯åœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡Œã€‚\ncp /etc/passwd . å…³äºæ–‡ä»¶çš„æ‰“åŒ…ç›´æ¥æŸ¥çœ‹ç¤ºä¾‹ä»£ç ï¼Œå·²ç»åœ¨ç¤ºä¾‹ä»£ç ä¸­åšäº†è¯¦ç»†çš„æ³¨é‡Šã€‚\nç¤ºä¾‹ä»£ç ï¼ˆ pack_single_file.go ï¼‰ï¼š\npackage main import ( \u0026#34;os\u0026#34; \u0026#34;log\u0026#34; \u0026#34;archive/tar\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; ) func main() { // å‡†å¤‡æ‰“åŒ…çš„æºæ–‡ä»¶ var srcFile = \u0026#34;passwd\u0026#34; // æ‰“åŒ…åçš„æ–‡ä»¶ var desFile = fmt.Sprintf(\u0026#34;%s.tar\u0026#34;,srcFile) // éœ€è¦æ³¨æ„æ–‡ä»¶çš„æ‰“å¼€å³å…³é—­çš„é¡ºåºï¼Œå› ä¸º defer æ˜¯åå…¥å…ˆå‡ºï¼Œæ‰€ä»¥å…³é—­é¡ºåºå¾ˆé‡è¦ // ç¬¬ä¸€æ¬¡å†™è¿™ä¸ªç¤ºä¾‹çš„æ—¶å€™å°±æ²¡æ³¨æ„ï¼Œå¯¼è‡´å†™å®Œçš„ tar åŒ…ä¸å®Œæ•´ // ###### ç¬¬ 1 æ­¥ï¼Œå…ˆå‡†å¤‡å¥½ä¸€ä¸ª tar.Writer ç»“æ„ï¼Œç„¶åå†å‘é‡Œé¢å†™å…¥å†…å®¹ã€‚ ###### // åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨æ¥ä¿å­˜æ‰“åŒ…åçš„ passwd.tar æ–‡ä»¶ fw, err := os.Create(desFile) ErrPrintln(err) defer fw.Close() // é€šè¿‡ fw åˆ›å»ºä¸€ä¸ª tar.Writer tw := tar.NewWriter(fw) // è¿™é‡Œä¸è¦å¿˜è®°å…³é—­ï¼Œå¦‚æœä¸èƒ½æˆåŠŸå…³é—­ä¼šé€ æˆ tar åŒ…ä¸å®Œæ•´ // æ‰€ä»¥è¿™é‡Œåœ¨å…³é—­çš„åŒæ—¶è¿›è¡Œåˆ¤æ–­ï¼Œå¯ä»¥æ¸…æ¥šçš„çŸ¥é“æ˜¯å¦æˆåŠŸå…³é—­ defer func() { if err := tw.Close(); err != nil { ErrPrintln(err) } }() // ###### ç¬¬ 2 æ­¥ï¼Œå¤„ç†æ–‡ä»¶ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ tar.Header ç›¸å…³çš„ ###### // tar åŒ…å…±æœ‰ä¸¤éƒ¨åˆ†å†…å®¹ï¼šæ–‡ä»¶ä¿¡æ¯å’Œæ–‡ä»¶æ•°æ® // é€šè¿‡ Stat è·å– FileInfoï¼Œç„¶åé€šè¿‡ FileInfoHeader å¾—åˆ° hdr tar.*Header fi, err := os.Stat(srcFile) ErrPrintln(err) hdr, err := tar.FileInfoHeader(fi, \u0026#34;\u0026#34;) // å°† tar çš„æ–‡ä»¶ä¿¡æ¯ hdr å†™å…¥åˆ° tw err = tw.WriteHeader(hdr) ErrPrintln(err) // å°†æ–‡ä»¶æ•°æ®å†™å…¥ // æ‰“å¼€å‡†å¤‡å†™å…¥çš„æ–‡ä»¶ fr, err := os.Open(srcFile) ErrPrintln(err) defer fr.Close() written, err := io.Copy(tw, fr) ErrPrintln(err) log.Printf(\u0026#34;å…±å†™å…¥äº† %d ä¸ªå­—ç¬¦çš„æ•°æ®\\n\u0026#34;,written) } // å®šä¹‰ä¸€ä¸ªç”¨æ¥æ‰“å°çš„å‡½æ•°ï¼Œå°‘å†™ç‚¹ä»£ç ï¼Œå› ä¸ºè¦å¤„ç†å¾ˆå¤šæ¬¡çš„ err // åé¢å…¶ä»–ç¤ºä¾‹è¿˜ä¼šç»§ç»­ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå°±ä¸å•ç‹¬å†å†™ï¼Œæœ›çœ‹åˆ°æ­¤å‡½æ•°äº†è§£ func ErrPrintln(err error) { if err != nil { log.Println(err) os.Exit(1) } } å•ä¸ªæ–‡ä»¶è§£åŒ… # è¿™ä¸ªä¹Ÿå¾ˆç®€å•ï¼ŒåŸºæœ¬ä¸Šå°†ä¸Šé¢è¿‡ç¨‹åè¿‡æ¥ï¼Œåªéœ€è¦å¤„ç† tar.Reader å³å¯ï¼Œè¯¦ç»†çš„æè¿°è§ç¤ºä¾‹ã€‚\nè¿™é‡Œå°±ç”¨åˆšåˆšæ‰“åŒ…çš„ passwd.tar æ–‡ä»¶åšç¤ºä¾‹ï¼Œå¦‚æœæ€•ç»“æœçœ‹ä¸å‡ºæ•ˆæœï¼Œå¯ä»¥å°†ä¹‹å‰ç”¨çš„ passwd æºæ–‡ä»¶åˆ é™¤ã€‚\nrm passwd ç¤ºä¾‹ä»£ç ï¼ˆ unpack_single_file.go ï¼‰ï¼š\npackage main import ( \u0026#34;os\u0026#34; \u0026#34;archive/tar\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; ) func main() { var srcFile = \u0026#34;passwd.tar\u0026#34; // å°† tar åŒ…æ‰“å¼€ fr, err := os.Open(srcFile) ErrPrintln(err) defer fr.Close() // é€šè¿‡ fr åˆ›å»ºä¸€ä¸ª tar.*Reader ç»“æ„ï¼Œç„¶åå°† tr éå†ï¼Œå¹¶å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸­ tr := tar.NewReader(fr) for hdr, err := tr.Next(); err != io.EOF; hdr, err = tr.Next(){ // å¤„ç† err ï¼= nil çš„æƒ…å†µ ErrPrintln(err) // è·å–æ–‡ä»¶ä¿¡æ¯ fi := hdr.FileInfo() // åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œç”¨æ¥å†™å…¥è§£åŒ…åçš„æ•°æ® fw, err := os.Create(fi.Name()) ErrPrintln(err) // å°† tr å†™å…¥åˆ° fw n, err := io.Copy(fw, tr) ErrPrintln(err) log.Printf(\u0026#34;è§£åŒ…ï¼š %s åˆ° %s ï¼Œå…±å¤„ç†äº† %d ä¸ªå­—ç¬¦çš„æ•°æ®ã€‚\u0026#34;, srcFile,fi.Name(),n) // è®¾ç½®æ–‡ä»¶æƒé™ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å’ŒåŸå§‹æ–‡ä»¶æƒé™ç›¸åŒï¼Œå¦‚æœä¸è®¾ç½®ï¼Œä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„ umask æ¥è®¾ç½®ã€‚ os.Chmod(fi.Name(),fi.Mode().Perm()) // æ³¨æ„ï¼Œå› ä¸ºæ˜¯åœ¨å¾ªç¯ä¸­ï¼Œæ‰€ä»¥å°±æ²¡æœ‰ä½¿ç”¨ defer å…³é—­æ–‡ä»¶ // å¦‚æœæƒ³ä½¿ç”¨ defer çš„è¯ï¼Œå¯ä»¥å°†æ–‡ä»¶å†™å…¥çš„æ­¥éª¤å•ç‹¬å°è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å³å¯ fw.Close() } } func ErrPrintln(err error){ if err != nil { log.Fatalln(err) os.Exit(1) } } æ“ä½œæ•´ä¸ªç›®å½• # æˆ‘ä»¬å®é™…ä¸­ tar å¾ˆå°‘ä¼šå»æ‰“åŒ…å•ä¸ªæ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½æ˜¯æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼Œå¹¶ä¸”æ‰“åŒ…çš„æ—¶å€™é€šè¿‡ gzip æˆ–è€… bzip2 å‹ç¼©ã€‚\nå¦‚æœè¦æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼Œå¯ä»¥é€šè¿‡é€’å½’çš„æ–¹å¼æ¥å®ç°ã€‚è¿™é‡Œåªæ¼”ç¤ºäº† gzip æ–¹å¼å‹ç¼©ï¼Œè¿™ä¸ªå®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨ fw å’Œ tw ä¹‹å‰åŠ ä¸Šä¸€å±‚å‹ç¼©å³å¯ï¼Œè¯¦æƒ…è§ç¤ºä¾‹ä»£ç ã€‚\nä¸ºäº†æµ‹è¯•æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼Œå¤åˆ¶äº†ä¸€ä¸ª log ç›®å½•åˆ°å½“å‰è·¯å¾„ä¸‹ã€‚ä»€ä¹ˆç›®å½•å’Œæ–‡ä»¶éƒ½å¯ä»¥ï¼Œåªæ˜¯å› ä¸ºè¿™ä¸ªé‡Œé¢å†…å®¹æ¯”è¾ƒå¤šï¼Œå°±æ‹¿è¿™ä¸ªæ¥åšæµ‹è¯•äº†ã€‚\n# å‡ºç°æ²¡æœ‰æƒé™çš„é”™è¯¯ä¸ç”¨ç®¡å®ƒï¼Œå¤åˆ¶è¿‡æ¥å¤šå°‘æ˜¯å¤šå°‘å§ cp -r /var/log/ . è¯¦ç»†çš„æ“ä½œä¼šåœ¨æ³¨é‡Šä¸­è¯´æ˜ï¼Œä¸è¿‡åœ¨ä¹‹å‰å•æ–‡ä»¶ä¸­å‡ºç°è¿‡çš„æ­¥éª¤ä¸å†æ³¨é‡Šã€‚\næ‰“åŒ…å‹ç¼© # ç¤ºä¾‹ä»£ç ï¼ˆ targz.go ï¼‰ï¼š\npackage main import ( \u0026#34;archive/tar\u0026#34; \u0026#34;compress/gzip\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;path/filepath\u0026#34; \u0026#34;strings\u0026#34; ) func main() { // ä¿®æ”¹æ—¥å¿—æ ¼å¼ï¼Œæ˜¾ç¤ºå‡ºé”™ä»£ç çš„æ‰€åœ¨è¡Œï¼Œæ–¹ä¾¿è°ƒè¯•ï¼Œå®é™…é¡¹ç›®ä¸­ä¸€èˆ¬ä¸è®°å½•è¿™ä¸ªã€‚ var src = \u0026#34;apt\u0026#34; var dst = fmt.Sprintf(\u0026#34;%s.tar.gz\u0026#34;, src) // å°†æ­¥éª¤å†™å…¥äº†ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œè¿™æ ·å¤„ç†é”™è¯¯æ–¹ä¾¿ä¸€äº› if err := Tar(src, dst); err != nil { log.Fatalln(err) } } func Tar(src, dst string) (err error) { // åˆ›å»ºæ–‡ä»¶ fw, err := os.Create(dst) if err != nil { return } defer fw.Close() // å°† tar åŒ…ä½¿ç”¨ gzip å‹ç¼©ï¼Œå…¶å®æ·»åŠ å‹ç¼©åŠŸèƒ½å¾ˆç®€å•ï¼Œ // åªéœ€è¦åœ¨ fw å’Œ tw ä¹‹å‰åŠ ä¸Šä¸€å±‚å‹ç¼©å°±è¡Œäº†ï¼Œå’Œ Linux çš„ç®¡é“çš„æ„Ÿè§‰ç±»ä¼¼ gw := gzip.NewWriter(fw) defer gw.Close() // åˆ›å»º Tar.Writer ç»“æ„ tw := tar.NewWriter(gw) // å¦‚æœéœ€è¦å¯ç”¨ gzip å°†ä¸Šé¢ä»£ç æ³¨é‡Šï¼Œæ¢æˆä¸‹é¢çš„ defer tw.Close() // ä¸‹é¢å°±è¯¥å¼€å§‹å¤„ç†æ•°æ®äº†ï¼Œè¿™é‡Œçš„æ€è·¯å°±æ˜¯é€’å½’å¤„ç†ç›®å½•åŠç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½• // è¿™é‡Œå¯ä»¥è‡ªå·±å†™ä¸ªé€’å½’æ¥å¤„ç†ï¼Œä¸è¿‡ Golang æä¾›äº† filepath.Walk å‡½æ•°ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åšè¿™ä¸ªäº‹æƒ… // ç›´æ¥å°†è¿™ä¸ªå‡½æ•°çš„å¤„ç†ç»“æœè¿”å›å°±è¡Œï¼Œéœ€è¦ä¼ ç»™å®ƒä¸€ä¸ªæºæ–‡ä»¶æˆ–ç›®å½•ï¼Œå®ƒå°±å¯ä»¥è‡ªå·±å»å¤„ç† // æˆ‘ä»¬å°±åªéœ€è¦å»å®ç°æˆ‘ä»¬è‡ªå·±çš„ æ‰“åŒ…é€»è¾‘å³å¯ï¼Œä¸éœ€è¦å†å»è·¯å¾„ç›¸å…³çš„äº‹æƒ… return filepath.Walk(src, func(fileName string, fi os.FileInfo, err error) error { // å› ä¸ºè¿™ä¸ªé—­åŒ…ä¼šè¿”å›ä¸ª error ï¼Œæ‰€ä»¥å…ˆè¦å¤„ç†ä¸€ä¸‹è¿™ä¸ª if err != nil { return err } // è¿™é‡Œå°±ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å† os.Stat äº†ï¼Œå®ƒå·²ç»åšå¥½äº†ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ fi å³å¯ hdr, err := tar.FileInfoHeader(fi, \u0026#34;\u0026#34;) if err != nil { return err } // è¿™é‡Œéœ€è¦å¤„ç†ä¸‹ hdr ä¸­çš„ Nameï¼Œå› ä¸ºé»˜è®¤æ–‡ä»¶çš„åå­—æ˜¯ä¸å¸¦è·¯å¾„çš„ï¼Œ // æ‰“åŒ…ä¹‹åæ‰€æœ‰æ–‡ä»¶å°±ä¼šå †åœ¨ä¸€èµ·ï¼Œè¿™æ ·å°±ç ´åäº†åŸæœ¬çš„ç›®å½•ç»“æœ // ä¾‹å¦‚ï¼š å°†åŸæœ¬ hdr.Name çš„ syslog æ›¿æ¢ç¨‹ log/syslog // è¿™ä¸ªå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå›è°ƒå‡½æ•°çš„ fileName å­—æ®µç»™æˆ‘ä»¬è¿”å›æ¥çš„å°±æ˜¯å®Œæ•´è·¯å¾„çš„ log/syslog // strings.TrimPrefix å°† fileName çš„æœ€å·¦ä¾§çš„ / å»æ‰ï¼Œ // ç†Ÿæ‚‰ Linux çš„éƒ½çŸ¥é“ä¸ºä»€ä¹ˆè¦å»æ‰è¿™ä¸ª hdr.Name = strings.TrimPrefix(fileName, string(filepath.Separator)) // å†™å…¥æ–‡ä»¶ä¿¡æ¯ if err := tw.WriteHeader(hdr); err != nil { return err } // åˆ¤æ–­ä¸‹æ–‡ä»¶æ˜¯å¦æ˜¯æ ‡å‡†æ–‡ä»¶ï¼Œå¦‚æœä¸æ˜¯å°±ä¸å¤„ç†äº†ï¼Œ // å¦‚ï¼š ç›®å½•ï¼Œè¿™é‡Œå°±åªè®°å½•äº†æ–‡ä»¶ä¿¡æ¯ï¼Œä¸ä¼šæ‰§è¡Œä¸‹é¢çš„ copy if !fi.Mode().IsRegular() { return nil } // æ‰“å¼€æ–‡ä»¶ fr, err := os.Open(fileName) defer fr.Close() if err != nil { return err } // copy æ–‡ä»¶æ•°æ®åˆ° tw n, err := io.Copy(tw, fr) if err != nil { return err } // è®°å½•ä¸‹è¿‡ç¨‹ï¼Œè¿™ä¸ªå¯ä»¥ä¸è®°å½•ï¼Œè¿™ä¸ªçœ‹éœ€è¦ï¼Œè¿™æ ·å¯ä»¥çœ‹åˆ°æ‰“åŒ…çš„è¿‡ç¨‹ log.Printf(\u0026#34;æˆåŠŸæ‰“åŒ… %s ï¼Œå…±å†™å…¥äº† %d å­—èŠ‚çš„æ•°æ®\\n\u0026#34;, fileName, n) return nil }) } æ‰“åŒ…åŠå‹ç¼©å°±æå®šäº†ï¼Œä¸è¿‡è¿™ä¸ªä»£ç ç°åœ¨æˆ‘è¿˜å‘ç°æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸èƒ½å¤„ç†è½¯é“¾æ¥\nè§£åŒ…è§£å‹ # è¿™ä¸ªè¿‡ç¨‹åŸºæœ¬å°±æ˜¯æŠŠå‹ç¼©çš„è¿‡ç¨‹è¿”å›æ¥ï¼Œå¤šäº†äº›åˆ›å»ºç›®å½•çš„æ“ä½œ\npackage main import ( \u0026#34;archive/tar\u0026#34; \u0026#34;compress/gzip\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; \u0026#34;path/filepath\u0026#34; ) func main() { var dst = \u0026#34;\u0026#34; // ä¸å†™å°±æ˜¯è§£å‹åˆ°å½“å‰ç›®å½• var src = \u0026#34;log.tar.gz\u0026#34; UnTar(dst, src) } func UnTar(dst, src string) (err error) { // æ‰“å¼€å‡†å¤‡è§£å‹çš„ tar åŒ… fr, err := os.Open(src) if err != nil { return } defer fr.Close() // å°†æ‰“å¼€çš„æ–‡ä»¶å…ˆè§£å‹ gr, err := gzip.NewReader(fr) if err != nil { return } defer gr.Close() // é€šè¿‡ gr åˆ›å»º tar.Reader tr := tar.NewReader(gr) // ç°åœ¨å·²ç»è·å¾—äº† tar.Reader ç»“æ„äº†ï¼Œåªéœ€è¦å¾ªç¯é‡Œé¢çš„æ•°æ®å†™å…¥æ–‡ä»¶å°±å¯ä»¥äº† for { hdr, err := tr.Next() switch { case err == io.EOF: return nil case err != nil: return err case hdr == nil: continue } // å¤„ç†ä¸‹ä¿å­˜è·¯å¾„ï¼Œå°†è¦ä¿å­˜çš„ç›®å½•åŠ ä¸Š header ä¸­çš„ Name // è¿™ä¸ªå˜é‡ä¿å­˜çš„æœ‰å¯èƒ½æ˜¯ç›®å½•ï¼Œæœ‰å¯èƒ½æ˜¯æ–‡ä»¶ï¼Œæ‰€ä»¥å°±å« FileDir äº†â€¦â€¦ dstFileDir := filepath.Join(dst, hdr.Name) // æ ¹æ® header çš„ Typeflag å­—æ®µï¼Œåˆ¤æ–­æ–‡ä»¶çš„ç±»å‹ switch hdr.Typeflag { case tar.TypeDir: // å¦‚æœæ˜¯ç›®å½•æ—¶å€™ï¼Œåˆ›å»ºç›®å½• // åˆ¤æ–­ä¸‹ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»º if b := ExistDir(dstFileDir); !b { // ä½¿ç”¨ MkdirAll ä¸ä½¿ç”¨ Mkdir ï¼Œå°±ç±»ä¼¼ Linux ç»ˆç«¯ä¸‹çš„ mkdir -pï¼Œ // å¯ä»¥é€’å½’åˆ›å»ºæ¯ä¸€çº§ç›®å½• if err := os.MkdirAll(dstFileDir, 0775); err != nil { return err } } case tar.TypeReg: // å¦‚æœæ˜¯æ–‡ä»¶å°±å†™å…¥åˆ°ç£ç›˜ // åˆ›å»ºä¸€ä¸ªå¯ä»¥è¯»å†™çš„æ–‡ä»¶ï¼Œæƒé™å°±ä½¿ç”¨ header ä¸­è®°å½•çš„æƒé™ // å› ä¸ºæ“ä½œç³»ç»Ÿçš„ FileMode æ˜¯ int32 ç±»å‹çš„ï¼Œhdr ä¸­çš„æ˜¯ int64ï¼Œæ‰€ä»¥è½¬æ¢ä¸‹ file, err := os.OpenFile(dstFileDir, os.O_CREATE|os.O_RDWR, os.FileMode(hdr.Mode)) if err != nil { return err } n, err := io.Copy(file, tr) if err != nil { return err } // å°†è§£å‹ç»“æœè¾“å‡ºæ˜¾ç¤º fmt.Printf(\u0026#34;æˆåŠŸè§£å‹ï¼š %s , å…±å¤„ç†äº† %d ä¸ªå­—ç¬¦\\n\u0026#34;, dstFileDir, n) // ä¸è¦å¿˜è®°å…³é—­æ‰“å¼€çš„æ–‡ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨ for å¾ªç¯ä¸­ï¼Œä¸èƒ½ä½¿ç”¨ defer // å¦‚æœæƒ³ä½¿ç”¨ defer å°±æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ file.Close() } } return nil } // åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ func ExistDir(dirname string) bool { fi, err := os.Stat(dirname) return (err == nil || os.IsExist(err)) \u0026amp;\u0026amp; fi.IsDir() } åˆ°è¿™é‡Œè§£å‹å°±å®Œæˆäº†ï¼Œåªæ˜¯ä¸€ä¸ªå®éªŒä»£ç ï¼Œè¿˜æœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼Œæ¬¢è¿æå‡ºå®è´µçš„æ„è§ã€‚\n","date":"15 July 2023","permalink":"/python/tests/","section":"Pythons","summary":"This is title # è¿™ä¸ªåŒ…æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†æ–‡ä»¶è¿›è¡Œæ‰“åŒ…å’Œè§£åŒ…ï¼Œè¦æ˜¯ç†Ÿæ‚‰ Linux ä¸‹çš„ tar å‘½ä»¤è¿™ä¸ªå°±å¾ˆå¥½ç†è§£äº†ã€‚ ä¸»è¦æ˜¯é€šè¿‡ tar.","title":"First Blog"},{"content":"è¿™é‡Œæ˜¯æ‘˜è¦\nThis is title # è¿™ä¸ªåŒ…æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†æ–‡ä»¶è¿›è¡Œæ‰“åŒ…å’Œè§£åŒ…ï¼Œè¦æ˜¯ç†Ÿæ‚‰ Linux ä¸‹çš„ tar å‘½ä»¤è¿™ä¸ªå°±å¾ˆå¥½ç†è§£äº†ã€‚ ä¸»è¦æ˜¯é€šè¿‡ tar.Reader è¯»å– tar åŒ…ï¼Œé€šè¿‡ tar.Writer å†™å…¥ tar åŒ…ï¼Œåœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­å†è®¾ç½®ä¸€ä¸‹å¤´ï¼Œè¯¦ç»†çš„è¿‡ç¨‹ä»¥ç¤ºä¾‹çš„æ–¹å¼è¿›è¡Œå±•ç¤ºï¼Œå¯ä»¥æŸ¥çœ‹ä»£ç é‡Œé¢çš„æ³¨é‡Šã€‚\nå‚è€ƒï¼š\næ ‡å‡†åº“ tar ä¸­æ–‡æ–‡æ¡£\næ ‡å‡†åº“ tar å®˜æ–¹æ–‡æ¡£\nå•ä¸ªæ–‡ä»¶æ“ä½œ # è¿™ä¸ªéå¸¸ç®€å•ï¼Œå°±æ˜¯è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿›è¡Œæ‰“åŒ…åŠè§£åŒ…æ“ä½œå³å¯ã€‚\nå•ä¸ªæ–‡ä»¶æ‰“åŒ… # ä» /etc/passwd ä¸‹å¤åˆ¶äº†ä¸€ä¸ª passwd æ–‡ä»¶åˆ°å½“å‰ç›®å½•ä¸‹ï¼Œç”¨æ¥åšå‹ç¼©æµ‹è¯•ã€‚ä»€ä¹ˆæ–‡ä»¶éƒ½æ˜¯å¯ä»¥çš„ï¼Œè‡ªå·±éšæ„å†™ä¸€ä¸ªä¹Ÿè¡Œã€‚è¿™é‡Œçš„ç¤ºä¾‹ä¸»è¦ä¸ºäº†è¯´æ˜ tar ï¼Œæ²¡æœ‰å¤„ç†è·¯å¾„ï¼Œæ‰€ä»¥è¿‡ç¨‹å…¨éƒ¨å‡è®¾æ˜¯åœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡Œã€‚\ncp /etc/passwd . å…³äºæ–‡ä»¶çš„æ‰“åŒ…ç›´æ¥æŸ¥çœ‹ç¤ºä¾‹ä»£ç ï¼Œå·²ç»åœ¨ç¤ºä¾‹ä»£ç ä¸­åšäº†è¯¦ç»†çš„æ³¨é‡Šã€‚\nç¤ºä¾‹ä»£ç ï¼ˆ pack_single_file.go ï¼‰ï¼š\npackage main import ( \u0026#34;os\u0026#34; \u0026#34;log\u0026#34; \u0026#34;archive/tar\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; ) func main() { // å‡†å¤‡æ‰“åŒ…çš„æºæ–‡ä»¶ var srcFile = \u0026#34;passwd\u0026#34; // æ‰“åŒ…åçš„æ–‡ä»¶ var desFile = fmt.Sprintf(\u0026#34;%s.tar\u0026#34;,srcFile) // éœ€è¦æ³¨æ„æ–‡ä»¶çš„æ‰“å¼€å³å…³é—­çš„é¡ºåºï¼Œå› ä¸º defer æ˜¯åå…¥å…ˆå‡ºï¼Œæ‰€ä»¥å…³é—­é¡ºåºå¾ˆé‡è¦ // ç¬¬ä¸€æ¬¡å†™è¿™ä¸ªç¤ºä¾‹çš„æ—¶å€™å°±æ²¡æ³¨æ„ï¼Œå¯¼è‡´å†™å®Œçš„ tar åŒ…ä¸å®Œæ•´ // ###### ç¬¬ 1 æ­¥ï¼Œå…ˆå‡†å¤‡å¥½ä¸€ä¸ª tar.Writer ç»“æ„ï¼Œç„¶åå†å‘é‡Œé¢å†™å…¥å†…å®¹ã€‚ ###### // åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨æ¥ä¿å­˜æ‰“åŒ…åçš„ passwd.tar æ–‡ä»¶ fw, err := os.Create(desFile) ErrPrintln(err) defer fw.Close() // é€šè¿‡ fw åˆ›å»ºä¸€ä¸ª tar.Writer tw := tar.NewWriter(fw) // è¿™é‡Œä¸è¦å¿˜è®°å…³é—­ï¼Œå¦‚æœä¸èƒ½æˆåŠŸå…³é—­ä¼šé€ æˆ tar åŒ…ä¸å®Œæ•´ // æ‰€ä»¥è¿™é‡Œåœ¨å…³é—­çš„åŒæ—¶è¿›è¡Œåˆ¤æ–­ï¼Œå¯ä»¥æ¸…æ¥šçš„çŸ¥é“æ˜¯å¦æˆåŠŸå…³é—­ defer func() { if err := tw.Close(); err != nil { ErrPrintln(err) } }() // ###### ç¬¬ 2 æ­¥ï¼Œå¤„ç†æ–‡ä»¶ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ tar.Header ç›¸å…³çš„ ###### // tar åŒ…å…±æœ‰ä¸¤éƒ¨åˆ†å†…å®¹ï¼šæ–‡ä»¶ä¿¡æ¯å’Œæ–‡ä»¶æ•°æ® // é€šè¿‡ Stat è·å– FileInfoï¼Œç„¶åé€šè¿‡ FileInfoHeader å¾—åˆ° hdr tar.*Header fi, err := os.Stat(srcFile) ErrPrintln(err) hdr, err := tar.FileInfoHeader(fi, \u0026#34;\u0026#34;) // å°† tar çš„æ–‡ä»¶ä¿¡æ¯ hdr å†™å…¥åˆ° tw err = tw.WriteHeader(hdr) ErrPrintln(err) // å°†æ–‡ä»¶æ•°æ®å†™å…¥ // æ‰“å¼€å‡†å¤‡å†™å…¥çš„æ–‡ä»¶ fr, err := os.Open(srcFile) ErrPrintln(err) defer fr.Close() written, err := io.Copy(tw, fr) ErrPrintln(err) log.Printf(\u0026#34;å…±å†™å…¥äº† %d ä¸ªå­—ç¬¦çš„æ•°æ®\\n\u0026#34;,written) } // å®šä¹‰ä¸€ä¸ªç”¨æ¥æ‰“å°çš„å‡½æ•°ï¼Œå°‘å†™ç‚¹ä»£ç ï¼Œå› ä¸ºè¦å¤„ç†å¾ˆå¤šæ¬¡çš„ err // åé¢å…¶ä»–ç¤ºä¾‹è¿˜ä¼šç»§ç»­ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå°±ä¸å•ç‹¬å†å†™ï¼Œæœ›çœ‹åˆ°æ­¤å‡½æ•°äº†è§£ func ErrPrintln(err error) { if err != nil { log.Println(err) os.Exit(1) } } å•ä¸ªæ–‡ä»¶è§£åŒ… # è¿™ä¸ªä¹Ÿå¾ˆç®€å•ï¼ŒåŸºæœ¬ä¸Šå°†ä¸Šé¢è¿‡ç¨‹åè¿‡æ¥ï¼Œåªéœ€è¦å¤„ç† tar.Reader å³å¯ï¼Œè¯¦ç»†çš„æè¿°è§ç¤ºä¾‹ã€‚\nè¿™é‡Œå°±ç”¨åˆšåˆšæ‰“åŒ…çš„ passwd.tar æ–‡ä»¶åšç¤ºä¾‹ï¼Œå¦‚æœæ€•ç»“æœçœ‹ä¸å‡ºæ•ˆæœï¼Œå¯ä»¥å°†ä¹‹å‰ç”¨çš„ passwd æºæ–‡ä»¶åˆ é™¤ã€‚\nrm passwd ç¤ºä¾‹ä»£ç ï¼ˆ unpack_single_file.go ï¼‰ï¼š\npackage main import ( \u0026#34;os\u0026#34; \u0026#34;archive/tar\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; ) func main() { var srcFile = \u0026#34;passwd.tar\u0026#34; // å°† tar åŒ…æ‰“å¼€ fr, err := os.Open(srcFile) ErrPrintln(err) defer fr.Close() // é€šè¿‡ fr åˆ›å»ºä¸€ä¸ª tar.*Reader ç»“æ„ï¼Œç„¶åå°† tr éå†ï¼Œå¹¶å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸­ tr := tar.NewReader(fr) for hdr, err := tr.Next(); err != io.EOF; hdr, err = tr.Next(){ // å¤„ç† err ï¼= nil çš„æƒ…å†µ ErrPrintln(err) // è·å–æ–‡ä»¶ä¿¡æ¯ fi := hdr.FileInfo() // åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œç”¨æ¥å†™å…¥è§£åŒ…åçš„æ•°æ® fw, err := os.Create(fi.Name()) ErrPrintln(err) // å°† tr å†™å…¥åˆ° fw n, err := io.Copy(fw, tr) ErrPrintln(err) log.Printf(\u0026#34;è§£åŒ…ï¼š %s åˆ° %s ï¼Œå…±å¤„ç†äº† %d ä¸ªå­—ç¬¦çš„æ•°æ®ã€‚\u0026#34;, srcFile,fi.Name(),n) // è®¾ç½®æ–‡ä»¶æƒé™ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å’ŒåŸå§‹æ–‡ä»¶æƒé™ç›¸åŒï¼Œå¦‚æœä¸è®¾ç½®ï¼Œä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„ umask æ¥è®¾ç½®ã€‚ os.Chmod(fi.Name(),fi.Mode().Perm()) // æ³¨æ„ï¼Œå› ä¸ºæ˜¯åœ¨å¾ªç¯ä¸­ï¼Œæ‰€ä»¥å°±æ²¡æœ‰ä½¿ç”¨ defer å…³é—­æ–‡ä»¶ // å¦‚æœæƒ³ä½¿ç”¨ defer çš„è¯ï¼Œå¯ä»¥å°†æ–‡ä»¶å†™å…¥çš„æ­¥éª¤å•ç‹¬å°è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å³å¯ fw.Close() } } func ErrPrintln(err error){ if err != nil { log.Fatalln(err) os.Exit(1) } } æ“ä½œæ•´ä¸ªç›®å½• # æˆ‘ä»¬å®é™…ä¸­ tar å¾ˆå°‘ä¼šå»æ‰“åŒ…å•ä¸ªæ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½æ˜¯æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼Œå¹¶ä¸”æ‰“åŒ…çš„æ—¶å€™é€šè¿‡ gzip æˆ–è€… bzip2 å‹ç¼©ã€‚\nå¦‚æœè¦æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼Œå¯ä»¥é€šè¿‡é€’å½’çš„æ–¹å¼æ¥å®ç°ã€‚è¿™é‡Œåªæ¼”ç¤ºäº† gzip æ–¹å¼å‹ç¼©ï¼Œè¿™ä¸ªå®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨ fw å’Œ tw ä¹‹å‰åŠ ä¸Šä¸€å±‚å‹ç¼©å³å¯ï¼Œè¯¦æƒ…è§ç¤ºä¾‹ä»£ç ã€‚\nä¸ºäº†æµ‹è¯•æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼Œå¤åˆ¶äº†ä¸€ä¸ª log ç›®å½•åˆ°å½“å‰è·¯å¾„ä¸‹ã€‚ä»€ä¹ˆç›®å½•å’Œæ–‡ä»¶éƒ½å¯ä»¥ï¼Œåªæ˜¯å› ä¸ºè¿™ä¸ªé‡Œé¢å†…å®¹æ¯”è¾ƒå¤šï¼Œå°±æ‹¿è¿™ä¸ªæ¥åšæµ‹è¯•äº†ã€‚\n# å‡ºç°æ²¡æœ‰æƒé™çš„é”™è¯¯ä¸ç”¨ç®¡å®ƒï¼Œå¤åˆ¶è¿‡æ¥å¤šå°‘æ˜¯å¤šå°‘å§ cp -r /var/log/ . è¯¦ç»†çš„æ“ä½œä¼šåœ¨æ³¨é‡Šä¸­è¯´æ˜ï¼Œä¸è¿‡åœ¨ä¹‹å‰å•æ–‡ä»¶ä¸­å‡ºç°è¿‡çš„æ­¥éª¤ä¸å†æ³¨é‡Šã€‚\næ‰“åŒ…å‹ç¼© # ç¤ºä¾‹ä»£ç ï¼ˆ targz.go ï¼‰ï¼š\npackage main import ( \u0026#34;archive/tar\u0026#34; \u0026#34;compress/gzip\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;path/filepath\u0026#34; \u0026#34;strings\u0026#34; ) func main() { // ä¿®æ”¹æ—¥å¿—æ ¼å¼ï¼Œæ˜¾ç¤ºå‡ºé”™ä»£ç çš„æ‰€åœ¨è¡Œï¼Œæ–¹ä¾¿è°ƒè¯•ï¼Œå®é™…é¡¹ç›®ä¸­ä¸€èˆ¬ä¸è®°å½•è¿™ä¸ªã€‚ var src = \u0026#34;apt\u0026#34; var dst = fmt.Sprintf(\u0026#34;%s.tar.gz\u0026#34;, src) // å°†æ­¥éª¤å†™å…¥äº†ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œè¿™æ ·å¤„ç†é”™è¯¯æ–¹ä¾¿ä¸€äº› if err := Tar(src, dst); err != nil { log.Fatalln(err) } } func Tar(src, dst string) (err error) { // åˆ›å»ºæ–‡ä»¶ fw, err := os.Create(dst) if err != nil { return } defer fw.Close() // å°† tar åŒ…ä½¿ç”¨ gzip å‹ç¼©ï¼Œå…¶å®æ·»åŠ å‹ç¼©åŠŸèƒ½å¾ˆç®€å•ï¼Œ // åªéœ€è¦åœ¨ fw å’Œ tw ä¹‹å‰åŠ ä¸Šä¸€å±‚å‹ç¼©å°±è¡Œäº†ï¼Œå’Œ Linux çš„ç®¡é“çš„æ„Ÿè§‰ç±»ä¼¼ gw := gzip.NewWriter(fw) defer gw.Close() // åˆ›å»º Tar.Writer ç»“æ„ tw := tar.NewWriter(gw) // å¦‚æœéœ€è¦å¯ç”¨ gzip å°†ä¸Šé¢ä»£ç æ³¨é‡Šï¼Œæ¢æˆä¸‹é¢çš„ defer tw.Close() // ä¸‹é¢å°±è¯¥å¼€å§‹å¤„ç†æ•°æ®äº†ï¼Œè¿™é‡Œçš„æ€è·¯å°±æ˜¯é€’å½’å¤„ç†ç›®å½•åŠç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½• // è¿™é‡Œå¯ä»¥è‡ªå·±å†™ä¸ªé€’å½’æ¥å¤„ç†ï¼Œä¸è¿‡ Golang æä¾›äº† filepath.Walk å‡½æ•°ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åšè¿™ä¸ªäº‹æƒ… // ç›´æ¥å°†è¿™ä¸ªå‡½æ•°çš„å¤„ç†ç»“æœè¿”å›å°±è¡Œï¼Œéœ€è¦ä¼ ç»™å®ƒä¸€ä¸ªæºæ–‡ä»¶æˆ–ç›®å½•ï¼Œå®ƒå°±å¯ä»¥è‡ªå·±å»å¤„ç† // æˆ‘ä»¬å°±åªéœ€è¦å»å®ç°æˆ‘ä»¬è‡ªå·±çš„ æ‰“åŒ…é€»è¾‘å³å¯ï¼Œä¸éœ€è¦å†å»è·¯å¾„ç›¸å…³çš„äº‹æƒ… return filepath.Walk(src, func(fileName string, fi os.FileInfo, err error) error { // å› ä¸ºè¿™ä¸ªé—­åŒ…ä¼šè¿”å›ä¸ª error ï¼Œæ‰€ä»¥å…ˆè¦å¤„ç†ä¸€ä¸‹è¿™ä¸ª if err != nil { return err } // è¿™é‡Œå°±ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å† os.Stat äº†ï¼Œå®ƒå·²ç»åšå¥½äº†ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ fi å³å¯ hdr, err := tar.FileInfoHeader(fi, \u0026#34;\u0026#34;) if err != nil { return err } // è¿™é‡Œéœ€è¦å¤„ç†ä¸‹ hdr ä¸­çš„ Nameï¼Œå› ä¸ºé»˜è®¤æ–‡ä»¶çš„åå­—æ˜¯ä¸å¸¦è·¯å¾„çš„ï¼Œ // æ‰“åŒ…ä¹‹åæ‰€æœ‰æ–‡ä»¶å°±ä¼šå †åœ¨ä¸€èµ·ï¼Œè¿™æ ·å°±ç ´åäº†åŸæœ¬çš„ç›®å½•ç»“æœ // ä¾‹å¦‚ï¼š å°†åŸæœ¬ hdr.Name çš„ syslog æ›¿æ¢ç¨‹ log/syslog // è¿™ä¸ªå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå›è°ƒå‡½æ•°çš„ fileName å­—æ®µç»™æˆ‘ä»¬è¿”å›æ¥çš„å°±æ˜¯å®Œæ•´è·¯å¾„çš„ log/syslog // strings.TrimPrefix å°† fileName çš„æœ€å·¦ä¾§çš„ / å»æ‰ï¼Œ // ç†Ÿæ‚‰ Linux çš„éƒ½çŸ¥é“ä¸ºä»€ä¹ˆè¦å»æ‰è¿™ä¸ª hdr.Name = strings.TrimPrefix(fileName, string(filepath.Separator)) // å†™å…¥æ–‡ä»¶ä¿¡æ¯ if err := tw.WriteHeader(hdr); err != nil { return err } // åˆ¤æ–­ä¸‹æ–‡ä»¶æ˜¯å¦æ˜¯æ ‡å‡†æ–‡ä»¶ï¼Œå¦‚æœä¸æ˜¯å°±ä¸å¤„ç†äº†ï¼Œ // å¦‚ï¼š ç›®å½•ï¼Œè¿™é‡Œå°±åªè®°å½•äº†æ–‡ä»¶ä¿¡æ¯ï¼Œä¸ä¼šæ‰§è¡Œä¸‹é¢çš„ copy if !fi.Mode().IsRegular() { return nil } // æ‰“å¼€æ–‡ä»¶ fr, err := os.Open(fileName) defer fr.Close() if err != nil { return err } // copy æ–‡ä»¶æ•°æ®åˆ° tw n, err := io.Copy(tw, fr) if err != nil { return err } // è®°å½•ä¸‹è¿‡ç¨‹ï¼Œè¿™ä¸ªå¯ä»¥ä¸è®°å½•ï¼Œè¿™ä¸ªçœ‹éœ€è¦ï¼Œè¿™æ ·å¯ä»¥çœ‹åˆ°æ‰“åŒ…çš„è¿‡ç¨‹ log.Printf(\u0026#34;æˆåŠŸæ‰“åŒ… %s ï¼Œå…±å†™å…¥äº† %d å­—èŠ‚çš„æ•°æ®\\n\u0026#34;, fileName, n) return nil }) } æ‰“åŒ…åŠå‹ç¼©å°±æå®šäº†ï¼Œä¸è¿‡è¿™ä¸ªä»£ç ç°åœ¨æˆ‘è¿˜å‘ç°æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸èƒ½å¤„ç†è½¯é“¾æ¥\nè§£åŒ…è§£å‹ # è¿™ä¸ªè¿‡ç¨‹åŸºæœ¬å°±æ˜¯æŠŠå‹ç¼©çš„è¿‡ç¨‹è¿”å›æ¥ï¼Œå¤šäº†äº›åˆ›å»ºç›®å½•çš„æ“ä½œ\npackage main import ( \u0026#34;archive/tar\u0026#34; \u0026#34;compress/gzip\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; \u0026#34;path/filepath\u0026#34; ) func main() { var dst = \u0026#34;\u0026#34; // ä¸å†™å°±æ˜¯è§£å‹åˆ°å½“å‰ç›®å½• var src = \u0026#34;log.tar.gz\u0026#34; UnTar(dst, src) } func UnTar(dst, src string) (err error) { // æ‰“å¼€å‡†å¤‡è§£å‹çš„ tar åŒ… fr, err := os.Open(src) if err != nil { return } defer fr.Close() // å°†æ‰“å¼€çš„æ–‡ä»¶å…ˆè§£å‹ gr, err := gzip.NewReader(fr) if err != nil { return } defer gr.Close() // é€šè¿‡ gr åˆ›å»º tar.Reader tr := tar.NewReader(gr) // ç°åœ¨å·²ç»è·å¾—äº† tar.Reader ç»“æ„äº†ï¼Œåªéœ€è¦å¾ªç¯é‡Œé¢çš„æ•°æ®å†™å…¥æ–‡ä»¶å°±å¯ä»¥äº† for { hdr, err := tr.Next() switch { case err == io.EOF: return nil case err != nil: return err case hdr == nil: continue } // å¤„ç†ä¸‹ä¿å­˜è·¯å¾„ï¼Œå°†è¦ä¿å­˜çš„ç›®å½•åŠ ä¸Š header ä¸­çš„ Name // è¿™ä¸ªå˜é‡ä¿å­˜çš„æœ‰å¯èƒ½æ˜¯ç›®å½•ï¼Œæœ‰å¯èƒ½æ˜¯æ–‡ä»¶ï¼Œæ‰€ä»¥å°±å« FileDir äº†â€¦â€¦ dstFileDir := filepath.Join(dst, hdr.Name) // æ ¹æ® header çš„ Typeflag å­—æ®µï¼Œåˆ¤æ–­æ–‡ä»¶çš„ç±»å‹ switch hdr.Typeflag { case tar.TypeDir: // å¦‚æœæ˜¯ç›®å½•æ—¶å€™ï¼Œåˆ›å»ºç›®å½• // åˆ¤æ–­ä¸‹ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»º if b := ExistDir(dstFileDir); !b { // ä½¿ç”¨ MkdirAll ä¸ä½¿ç”¨ Mkdir ï¼Œå°±ç±»ä¼¼ Linux ç»ˆç«¯ä¸‹çš„ mkdir -pï¼Œ // å¯ä»¥é€’å½’åˆ›å»ºæ¯ä¸€çº§ç›®å½• if err := os.MkdirAll(dstFileDir, 0775); err != nil { return err } } case tar.TypeReg: // å¦‚æœæ˜¯æ–‡ä»¶å°±å†™å…¥åˆ°ç£ç›˜ // åˆ›å»ºä¸€ä¸ªå¯ä»¥è¯»å†™çš„æ–‡ä»¶ï¼Œæƒé™å°±ä½¿ç”¨ header ä¸­è®°å½•çš„æƒé™ // å› ä¸ºæ“ä½œç³»ç»Ÿçš„ FileMode æ˜¯ int32 ç±»å‹çš„ï¼Œhdr ä¸­çš„æ˜¯ int64ï¼Œæ‰€ä»¥è½¬æ¢ä¸‹ file, err := os.OpenFile(dstFileDir, os.O_CREATE|os.O_RDWR, os.FileMode(hdr.Mode)) if err != nil { return err } n, err := io.Copy(file, tr) if err != nil { return err } // å°†è§£å‹ç»“æœè¾“å‡ºæ˜¾ç¤º fmt.Printf(\u0026#34;æˆåŠŸè§£å‹ï¼š %s , å…±å¤„ç†äº† %d ä¸ªå­—ç¬¦\\n\u0026#34;, dstFileDir, n) // ä¸è¦å¿˜è®°å…³é—­æ‰“å¼€çš„æ–‡ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨ for å¾ªç¯ä¸­ï¼Œä¸èƒ½ä½¿ç”¨ defer // å¦‚æœæƒ³ä½¿ç”¨ defer å°±æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ file.Close() } } return nil } // åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ func ExistDir(dirname string) bool { fi, err := os.Stat(dirname) return (err == nil || os.IsExist(err)) \u0026amp;\u0026amp; fi.IsDir() } åˆ°è¿™é‡Œè§£å‹å°±å®Œæˆäº†ï¼Œåªæ˜¯ä¸€ä¸ªå®éªŒä»£ç ï¼Œè¿˜æœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼Œæ¬¢è¿æå‡ºå®è´µçš„æ„è§ã€‚\n","date":"15 July 2023","permalink":"/golang/first-blog/","section":"Golangs","summary":"è¿™é‡Œæ˜¯æ‘˜è¦","title":"Go è¯­è¨€åšå®¢ç¬¬ä¸€ç¯‡"},{"content":" This is title # è¿™ä¸ªåŒ…æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†æ–‡ä»¶è¿›è¡Œæ‰“åŒ…å’Œè§£åŒ…ï¼Œè¦æ˜¯ç†Ÿæ‚‰ Linux ä¸‹çš„ tar å‘½ä»¤è¿™ä¸ªå°±å¾ˆå¥½ç†è§£äº†ã€‚ ä¸»è¦æ˜¯é€šè¿‡ tar.Reader è¯»å– tar åŒ…ï¼Œé€šè¿‡ tar.Writer å†™å…¥ tar åŒ…ï¼Œåœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­å†è®¾ç½®ä¸€ä¸‹å¤´ï¼Œè¯¦ç»†çš„è¿‡ç¨‹ä»¥ç¤ºä¾‹çš„æ–¹å¼è¿›è¡Œå±•ç¤ºï¼Œå¯ä»¥æŸ¥çœ‹ä»£ç é‡Œé¢çš„æ³¨é‡Šã€‚\nå‚è€ƒï¼š\næ ‡å‡†åº“ tar ä¸­æ–‡æ–‡æ¡£\næ ‡å‡†åº“ tar å®˜æ–¹æ–‡æ¡£\nå•ä¸ªæ–‡ä»¶æ“ä½œ # è¿™ä¸ªéå¸¸ç®€å•ï¼Œå°±æ˜¯è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿›è¡Œæ‰“åŒ…åŠè§£åŒ…æ“ä½œå³å¯ã€‚\nå•ä¸ªæ–‡ä»¶æ‰“åŒ… # ä» /etc/passwd ä¸‹å¤åˆ¶äº†ä¸€ä¸ª passwd æ–‡ä»¶åˆ°å½“å‰ç›®å½•ä¸‹ï¼Œç”¨æ¥åšå‹ç¼©æµ‹è¯•ã€‚ä»€ä¹ˆæ–‡ä»¶éƒ½æ˜¯å¯ä»¥çš„ï¼Œè‡ªå·±éšæ„å†™ä¸€ä¸ªä¹Ÿè¡Œã€‚è¿™é‡Œçš„ç¤ºä¾‹ä¸»è¦ä¸ºäº†è¯´æ˜ tar ï¼Œæ²¡æœ‰å¤„ç†è·¯å¾„ï¼Œæ‰€ä»¥è¿‡ç¨‹å…¨éƒ¨å‡è®¾æ˜¯åœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡Œã€‚\ncp /etc/passwd . å…³äºæ–‡ä»¶çš„æ‰“åŒ…ç›´æ¥æŸ¥çœ‹ç¤ºä¾‹ä»£ç ï¼Œå·²ç»åœ¨ç¤ºä¾‹ä»£ç ä¸­åšäº†è¯¦ç»†çš„æ³¨é‡Šã€‚\nç¤ºä¾‹ä»£ç ï¼ˆ pack_single_file.go ï¼‰ï¼š\npackage main import ( \u0026#34;os\u0026#34; \u0026#34;log\u0026#34; \u0026#34;archive/tar\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; ) func main() { // å‡†å¤‡æ‰“åŒ…çš„æºæ–‡ä»¶ var srcFile = \u0026#34;passwd\u0026#34; // æ‰“åŒ…åçš„æ–‡ä»¶ var desFile = fmt.Sprintf(\u0026#34;%s.tar\u0026#34;,srcFile) // éœ€è¦æ³¨æ„æ–‡ä»¶çš„æ‰“å¼€å³å…³é—­çš„é¡ºåºï¼Œå› ä¸º defer æ˜¯åå…¥å…ˆå‡ºï¼Œæ‰€ä»¥å…³é—­é¡ºåºå¾ˆé‡è¦ // ç¬¬ä¸€æ¬¡å†™è¿™ä¸ªç¤ºä¾‹çš„æ—¶å€™å°±æ²¡æ³¨æ„ï¼Œå¯¼è‡´å†™å®Œçš„ tar åŒ…ä¸å®Œæ•´ // ###### ç¬¬ 1 æ­¥ï¼Œå…ˆå‡†å¤‡å¥½ä¸€ä¸ª tar.Writer ç»“æ„ï¼Œç„¶åå†å‘é‡Œé¢å†™å…¥å†…å®¹ã€‚ ###### // åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨æ¥ä¿å­˜æ‰“åŒ…åçš„ passwd.tar æ–‡ä»¶ fw, err := os.Create(desFile) ErrPrintln(err) defer fw.Close() // é€šè¿‡ fw åˆ›å»ºä¸€ä¸ª tar.Writer tw := tar.NewWriter(fw) // è¿™é‡Œä¸è¦å¿˜è®°å…³é—­ï¼Œå¦‚æœä¸èƒ½æˆåŠŸå…³é—­ä¼šé€ æˆ tar åŒ…ä¸å®Œæ•´ // æ‰€ä»¥è¿™é‡Œåœ¨å…³é—­çš„åŒæ—¶è¿›è¡Œåˆ¤æ–­ï¼Œå¯ä»¥æ¸…æ¥šçš„çŸ¥é“æ˜¯å¦æˆåŠŸå…³é—­ defer func() { if err := tw.Close(); err != nil { ErrPrintln(err) } }() // ###### ç¬¬ 2 æ­¥ï¼Œå¤„ç†æ–‡ä»¶ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ tar.Header ç›¸å…³çš„ ###### // tar åŒ…å…±æœ‰ä¸¤éƒ¨åˆ†å†…å®¹ï¼šæ–‡ä»¶ä¿¡æ¯å’Œæ–‡ä»¶æ•°æ® // é€šè¿‡ Stat è·å– FileInfoï¼Œç„¶åé€šè¿‡ FileInfoHeader å¾—åˆ° hdr tar.*Header fi, err := os.Stat(srcFile) ErrPrintln(err) hdr, err := tar.FileInfoHeader(fi, \u0026#34;\u0026#34;) // å°† tar çš„æ–‡ä»¶ä¿¡æ¯ hdr å†™å…¥åˆ° tw err = tw.WriteHeader(hdr) ErrPrintln(err) // å°†æ–‡ä»¶æ•°æ®å†™å…¥ // æ‰“å¼€å‡†å¤‡å†™å…¥çš„æ–‡ä»¶ fr, err := os.Open(srcFile) ErrPrintln(err) defer fr.Close() written, err := io.Copy(tw, fr) ErrPrintln(err) log.Printf(\u0026#34;å…±å†™å…¥äº† %d ä¸ªå­—ç¬¦çš„æ•°æ®\\n\u0026#34;,written) } // å®šä¹‰ä¸€ä¸ªç”¨æ¥æ‰“å°çš„å‡½æ•°ï¼Œå°‘å†™ç‚¹ä»£ç ï¼Œå› ä¸ºè¦å¤„ç†å¾ˆå¤šæ¬¡çš„ err // åé¢å…¶ä»–ç¤ºä¾‹è¿˜ä¼šç»§ç»­ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå°±ä¸å•ç‹¬å†å†™ï¼Œæœ›çœ‹åˆ°æ­¤å‡½æ•°äº†è§£ func ErrPrintln(err error) { if err != nil { log.Println(err) os.Exit(1) } } å•ä¸ªæ–‡ä»¶è§£åŒ… # è¿™ä¸ªä¹Ÿå¾ˆç®€å•ï¼ŒåŸºæœ¬ä¸Šå°†ä¸Šé¢è¿‡ç¨‹åè¿‡æ¥ï¼Œåªéœ€è¦å¤„ç† tar.Reader å³å¯ï¼Œè¯¦ç»†çš„æè¿°è§ç¤ºä¾‹ã€‚\nè¿™é‡Œå°±ç”¨åˆšåˆšæ‰“åŒ…çš„ passwd.tar æ–‡ä»¶åšç¤ºä¾‹ï¼Œå¦‚æœæ€•ç»“æœçœ‹ä¸å‡ºæ•ˆæœï¼Œå¯ä»¥å°†ä¹‹å‰ç”¨çš„ passwd æºæ–‡ä»¶åˆ é™¤ã€‚\nrm passwd ç¤ºä¾‹ä»£ç ï¼ˆ unpack_single_file.go ï¼‰ï¼š\npackage main import ( \u0026#34;os\u0026#34; \u0026#34;archive/tar\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; ) func main() { var srcFile = \u0026#34;passwd.tar\u0026#34; // å°† tar åŒ…æ‰“å¼€ fr, err := os.Open(srcFile) ErrPrintln(err) defer fr.Close() // é€šè¿‡ fr åˆ›å»ºä¸€ä¸ª tar.*Reader ç»“æ„ï¼Œç„¶åå°† tr éå†ï¼Œå¹¶å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸­ tr := tar.NewReader(fr) for hdr, err := tr.Next(); err != io.EOF; hdr, err = tr.Next(){ // å¤„ç† err ï¼= nil çš„æƒ…å†µ ErrPrintln(err) // è·å–æ–‡ä»¶ä¿¡æ¯ fi := hdr.FileInfo() // åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œç”¨æ¥å†™å…¥è§£åŒ…åçš„æ•°æ® fw, err := os.Create(fi.Name()) ErrPrintln(err) // å°† tr å†™å…¥åˆ° fw n, err := io.Copy(fw, tr) ErrPrintln(err) log.Printf(\u0026#34;è§£åŒ…ï¼š %s åˆ° %s ï¼Œå…±å¤„ç†äº† %d ä¸ªå­—ç¬¦çš„æ•°æ®ã€‚\u0026#34;, srcFile,fi.Name(),n) // è®¾ç½®æ–‡ä»¶æƒé™ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å’ŒåŸå§‹æ–‡ä»¶æƒé™ç›¸åŒï¼Œå¦‚æœä¸è®¾ç½®ï¼Œä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„ umask æ¥è®¾ç½®ã€‚ os.Chmod(fi.Name(),fi.Mode().Perm()) // æ³¨æ„ï¼Œå› ä¸ºæ˜¯åœ¨å¾ªç¯ä¸­ï¼Œæ‰€ä»¥å°±æ²¡æœ‰ä½¿ç”¨ defer å…³é—­æ–‡ä»¶ // å¦‚æœæƒ³ä½¿ç”¨ defer çš„è¯ï¼Œå¯ä»¥å°†æ–‡ä»¶å†™å…¥çš„æ­¥éª¤å•ç‹¬å°è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å³å¯ fw.Close() } } func ErrPrintln(err error){ if err != nil { log.Fatalln(err) os.Exit(1) } } æ“ä½œæ•´ä¸ªç›®å½• # æˆ‘ä»¬å®é™…ä¸­ tar å¾ˆå°‘ä¼šå»æ‰“åŒ…å•ä¸ªæ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½æ˜¯æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼Œå¹¶ä¸”æ‰“åŒ…çš„æ—¶å€™é€šè¿‡ gzip æˆ–è€… bzip2 å‹ç¼©ã€‚\nå¦‚æœè¦æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼Œå¯ä»¥é€šè¿‡é€’å½’çš„æ–¹å¼æ¥å®ç°ã€‚è¿™é‡Œåªæ¼”ç¤ºäº† gzip æ–¹å¼å‹ç¼©ï¼Œè¿™ä¸ªå®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨ fw å’Œ tw ä¹‹å‰åŠ ä¸Šä¸€å±‚å‹ç¼©å³å¯ï¼Œè¯¦æƒ…è§ç¤ºä¾‹ä»£ç ã€‚\nä¸ºäº†æµ‹è¯•æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼Œå¤åˆ¶äº†ä¸€ä¸ª log ç›®å½•åˆ°å½“å‰è·¯å¾„ä¸‹ã€‚ä»€ä¹ˆç›®å½•å’Œæ–‡ä»¶éƒ½å¯ä»¥ï¼Œåªæ˜¯å› ä¸ºè¿™ä¸ªé‡Œé¢å†…å®¹æ¯”è¾ƒå¤šï¼Œå°±æ‹¿è¿™ä¸ªæ¥åšæµ‹è¯•äº†ã€‚\n# å‡ºç°æ²¡æœ‰æƒé™çš„é”™è¯¯ä¸ç”¨ç®¡å®ƒï¼Œå¤åˆ¶è¿‡æ¥å¤šå°‘æ˜¯å¤šå°‘å§ cp -r /var/log/ . è¯¦ç»†çš„æ“ä½œä¼šåœ¨æ³¨é‡Šä¸­è¯´æ˜ï¼Œä¸è¿‡åœ¨ä¹‹å‰å•æ–‡ä»¶ä¸­å‡ºç°è¿‡çš„æ­¥éª¤ä¸å†æ³¨é‡Šã€‚\næ‰“åŒ…å‹ç¼© # ç¤ºä¾‹ä»£ç ï¼ˆ targz.go ï¼‰ï¼š\npackage main import ( \u0026#34;archive/tar\u0026#34; \u0026#34;compress/gzip\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;path/filepath\u0026#34; \u0026#34;strings\u0026#34; ) func main() { // ä¿®æ”¹æ—¥å¿—æ ¼å¼ï¼Œæ˜¾ç¤ºå‡ºé”™ä»£ç çš„æ‰€åœ¨è¡Œï¼Œæ–¹ä¾¿è°ƒè¯•ï¼Œå®é™…é¡¹ç›®ä¸­ä¸€èˆ¬ä¸è®°å½•è¿™ä¸ªã€‚ var src = \u0026#34;apt\u0026#34; var dst = fmt.Sprintf(\u0026#34;%s.tar.gz\u0026#34;, src) // å°†æ­¥éª¤å†™å…¥äº†ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œè¿™æ ·å¤„ç†é”™è¯¯æ–¹ä¾¿ä¸€äº› if err := Tar(src, dst); err != nil { log.Fatalln(err) } } func Tar(src, dst string) (err error) { // åˆ›å»ºæ–‡ä»¶ fw, err := os.Create(dst) if err != nil { return } defer fw.Close() // å°† tar åŒ…ä½¿ç”¨ gzip å‹ç¼©ï¼Œå…¶å®æ·»åŠ å‹ç¼©åŠŸèƒ½å¾ˆç®€å•ï¼Œ // åªéœ€è¦åœ¨ fw å’Œ tw ä¹‹å‰åŠ ä¸Šä¸€å±‚å‹ç¼©å°±è¡Œäº†ï¼Œå’Œ Linux çš„ç®¡é“çš„æ„Ÿè§‰ç±»ä¼¼ gw := gzip.NewWriter(fw) defer gw.Close() // åˆ›å»º Tar.Writer ç»“æ„ tw := tar.NewWriter(gw) // å¦‚æœéœ€è¦å¯ç”¨ gzip å°†ä¸Šé¢ä»£ç æ³¨é‡Šï¼Œæ¢æˆä¸‹é¢çš„ defer tw.Close() // ä¸‹é¢å°±è¯¥å¼€å§‹å¤„ç†æ•°æ®äº†ï¼Œè¿™é‡Œçš„æ€è·¯å°±æ˜¯é€’å½’å¤„ç†ç›®å½•åŠç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½• // è¿™é‡Œå¯ä»¥è‡ªå·±å†™ä¸ªé€’å½’æ¥å¤„ç†ï¼Œä¸è¿‡ Golang æä¾›äº† filepath.Walk å‡½æ•°ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åšè¿™ä¸ªäº‹æƒ… // ç›´æ¥å°†è¿™ä¸ªå‡½æ•°çš„å¤„ç†ç»“æœè¿”å›å°±è¡Œï¼Œéœ€è¦ä¼ ç»™å®ƒä¸€ä¸ªæºæ–‡ä»¶æˆ–ç›®å½•ï¼Œå®ƒå°±å¯ä»¥è‡ªå·±å»å¤„ç† // æˆ‘ä»¬å°±åªéœ€è¦å»å®ç°æˆ‘ä»¬è‡ªå·±çš„ æ‰“åŒ…é€»è¾‘å³å¯ï¼Œä¸éœ€è¦å†å»è·¯å¾„ç›¸å…³çš„äº‹æƒ… return filepath.Walk(src, func(fileName string, fi os.FileInfo, err error) error { // å› ä¸ºè¿™ä¸ªé—­åŒ…ä¼šè¿”å›ä¸ª error ï¼Œæ‰€ä»¥å…ˆè¦å¤„ç†ä¸€ä¸‹è¿™ä¸ª if err != nil { return err } // è¿™é‡Œå°±ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å† os.Stat äº†ï¼Œå®ƒå·²ç»åšå¥½äº†ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ fi å³å¯ hdr, err := tar.FileInfoHeader(fi, \u0026#34;\u0026#34;) if err != nil { return err } // è¿™é‡Œéœ€è¦å¤„ç†ä¸‹ hdr ä¸­çš„ Nameï¼Œå› ä¸ºé»˜è®¤æ–‡ä»¶çš„åå­—æ˜¯ä¸å¸¦è·¯å¾„çš„ï¼Œ // æ‰“åŒ…ä¹‹åæ‰€æœ‰æ–‡ä»¶å°±ä¼šå †åœ¨ä¸€èµ·ï¼Œè¿™æ ·å°±ç ´åäº†åŸæœ¬çš„ç›®å½•ç»“æœ // ä¾‹å¦‚ï¼š å°†åŸæœ¬ hdr.Name çš„ syslog æ›¿æ¢ç¨‹ log/syslog // è¿™ä¸ªå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå›è°ƒå‡½æ•°çš„ fileName å­—æ®µç»™æˆ‘ä»¬è¿”å›æ¥çš„å°±æ˜¯å®Œæ•´è·¯å¾„çš„ log/syslog // strings.TrimPrefix å°† fileName çš„æœ€å·¦ä¾§çš„ / å»æ‰ï¼Œ // ç†Ÿæ‚‰ Linux çš„éƒ½çŸ¥é“ä¸ºä»€ä¹ˆè¦å»æ‰è¿™ä¸ª hdr.Name = strings.TrimPrefix(fileName, string(filepath.Separator)) // å†™å…¥æ–‡ä»¶ä¿¡æ¯ if err := tw.WriteHeader(hdr); err != nil { return err } // åˆ¤æ–­ä¸‹æ–‡ä»¶æ˜¯å¦æ˜¯æ ‡å‡†æ–‡ä»¶ï¼Œå¦‚æœä¸æ˜¯å°±ä¸å¤„ç†äº†ï¼Œ // å¦‚ï¼š ç›®å½•ï¼Œè¿™é‡Œå°±åªè®°å½•äº†æ–‡ä»¶ä¿¡æ¯ï¼Œä¸ä¼šæ‰§è¡Œä¸‹é¢çš„ copy if !fi.Mode().IsRegular() { return nil } // æ‰“å¼€æ–‡ä»¶ fr, err := os.Open(fileName) defer fr.Close() if err != nil { return err } // copy æ–‡ä»¶æ•°æ®åˆ° tw n, err := io.Copy(tw, fr) if err != nil { return err } // è®°å½•ä¸‹è¿‡ç¨‹ï¼Œè¿™ä¸ªå¯ä»¥ä¸è®°å½•ï¼Œè¿™ä¸ªçœ‹éœ€è¦ï¼Œè¿™æ ·å¯ä»¥çœ‹åˆ°æ‰“åŒ…çš„è¿‡ç¨‹ log.Printf(\u0026#34;æˆåŠŸæ‰“åŒ… %s ï¼Œå…±å†™å…¥äº† %d å­—èŠ‚çš„æ•°æ®\\n\u0026#34;, fileName, n) return nil }) } æ‰“åŒ…åŠå‹ç¼©å°±æå®šäº†ï¼Œä¸è¿‡è¿™ä¸ªä»£ç ç°åœ¨æˆ‘è¿˜å‘ç°æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸èƒ½å¤„ç†è½¯é“¾æ¥\nè§£åŒ…è§£å‹ # è¿™ä¸ªè¿‡ç¨‹åŸºæœ¬å°±æ˜¯æŠŠå‹ç¼©çš„è¿‡ç¨‹è¿”å›æ¥ï¼Œå¤šäº†äº›åˆ›å»ºç›®å½•çš„æ“ä½œ\npackage main import ( \u0026#34;archive/tar\u0026#34; \u0026#34;compress/gzip\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; \u0026#34;path/filepath\u0026#34; ) func main() { var dst = \u0026#34;\u0026#34; // ä¸å†™å°±æ˜¯è§£å‹åˆ°å½“å‰ç›®å½• var src = \u0026#34;log.tar.gz\u0026#34; UnTar(dst, src) } func UnTar(dst, src string) (err error) { // æ‰“å¼€å‡†å¤‡è§£å‹çš„ tar åŒ… fr, err := os.Open(src) if err != nil { return } defer fr.Close() // å°†æ‰“å¼€çš„æ–‡ä»¶å…ˆè§£å‹ gr, err := gzip.NewReader(fr) if err != nil { return } defer gr.Close() // é€šè¿‡ gr åˆ›å»º tar.Reader tr := tar.NewReader(gr) // ç°åœ¨å·²ç»è·å¾—äº† tar.Reader ç»“æ„äº†ï¼Œåªéœ€è¦å¾ªç¯é‡Œé¢çš„æ•°æ®å†™å…¥æ–‡ä»¶å°±å¯ä»¥äº† for { hdr, err := tr.Next() switch { case err == io.EOF: return nil case err != nil: return err case hdr == nil: continue } // å¤„ç†ä¸‹ä¿å­˜è·¯å¾„ï¼Œå°†è¦ä¿å­˜çš„ç›®å½•åŠ ä¸Š header ä¸­çš„ Name // è¿™ä¸ªå˜é‡ä¿å­˜çš„æœ‰å¯èƒ½æ˜¯ç›®å½•ï¼Œæœ‰å¯èƒ½æ˜¯æ–‡ä»¶ï¼Œæ‰€ä»¥å°±å« FileDir äº†â€¦â€¦ dstFileDir := filepath.Join(dst, hdr.Name) // æ ¹æ® header çš„ Typeflag å­—æ®µï¼Œåˆ¤æ–­æ–‡ä»¶çš„ç±»å‹ switch hdr.Typeflag { case tar.TypeDir: // å¦‚æœæ˜¯ç›®å½•æ—¶å€™ï¼Œåˆ›å»ºç›®å½• // åˆ¤æ–­ä¸‹ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»º if b := ExistDir(dstFileDir); !b { // ä½¿ç”¨ MkdirAll ä¸ä½¿ç”¨ Mkdir ï¼Œå°±ç±»ä¼¼ Linux ç»ˆç«¯ä¸‹çš„ mkdir -pï¼Œ // å¯ä»¥é€’å½’åˆ›å»ºæ¯ä¸€çº§ç›®å½• if err := os.MkdirAll(dstFileDir, 0775); err != nil { return err } } case tar.TypeReg: // å¦‚æœæ˜¯æ–‡ä»¶å°±å†™å…¥åˆ°ç£ç›˜ // åˆ›å»ºä¸€ä¸ªå¯ä»¥è¯»å†™çš„æ–‡ä»¶ï¼Œæƒé™å°±ä½¿ç”¨ header ä¸­è®°å½•çš„æƒé™ // å› ä¸ºæ“ä½œç³»ç»Ÿçš„ FileMode æ˜¯ int32 ç±»å‹çš„ï¼Œhdr ä¸­çš„æ˜¯ int64ï¼Œæ‰€ä»¥è½¬æ¢ä¸‹ file, err := os.OpenFile(dstFileDir, os.O_CREATE|os.O_RDWR, os.FileMode(hdr.Mode)) if err != nil { return err } n, err := io.Copy(file, tr) if err != nil { return err } // å°†è§£å‹ç»“æœè¾“å‡ºæ˜¾ç¤º fmt.Printf(\u0026#34;æˆåŠŸè§£å‹ï¼š %s , å…±å¤„ç†äº† %d ä¸ªå­—ç¬¦\\n\u0026#34;, dstFileDir, n) // ä¸è¦å¿˜è®°å…³é—­æ‰“å¼€çš„æ–‡ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨ for å¾ªç¯ä¸­ï¼Œä¸èƒ½ä½¿ç”¨ defer // å¦‚æœæƒ³ä½¿ç”¨ defer å°±æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ file.Close() } } return nil } // åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ func ExistDir(dirname string) bool { fi, err := os.Stat(dirname) return (err == nil || os.IsExist(err)) \u0026amp;\u0026amp; fi.IsDir() } åˆ°è¿™é‡Œè§£å‹å°±å®Œæˆäº†ï¼Œåªæ˜¯ä¸€ä¸ªå®éªŒä»£ç ï¼Œè¿˜æœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼Œæ¬¢è¿æå‡ºå®è´µçš„æ„è§ã€‚\n","date":"15 July 2023","permalink":"/golang/test-blog/","section":"Golangs","summary":"This is title # è¿™ä¸ªåŒ…æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†æ–‡ä»¶è¿›è¡Œæ‰“åŒ…å’Œè§£åŒ…ï¼Œè¦æ˜¯ç†Ÿæ‚‰ Linux ä¸‹çš„ tar å‘½ä»¤è¿™ä¸ªå°±å¾ˆå¥½ç†è§£äº†ã€‚ ä¸»è¦æ˜¯é€šè¿‡ tar.","title":"GO è¯­è¨€åšå®¢ç¬¬äºŒç¯‡"},{"content":"","date":"15 July 2023","permalink":"/golang/","section":"Golangs","summary":"","title":"Golangs"},{"content":"","date":"15 July 2023","permalink":"/linux/","section":"Linuxes","summary":"","title":"Linuxes"},{"content":" This is title # è¿™ä¸ªåŒ…æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†æ–‡ä»¶è¿›è¡Œæ‰“åŒ…å’Œè§£åŒ…ï¼Œè¦æ˜¯ç†Ÿæ‚‰ Linux ä¸‹çš„ tar å‘½ä»¤è¿™ä¸ªå°±å¾ˆå¥½ç†è§£äº†ã€‚ ä¸»è¦æ˜¯é€šè¿‡ tar.Reader è¯»å– tar åŒ…ï¼Œé€šè¿‡ tar.Writer å†™å…¥ tar åŒ…ï¼Œåœ¨å†™å…¥çš„è¿‡ç¨‹ä¸­å†è®¾ç½®ä¸€ä¸‹å¤´ï¼Œè¯¦ç»†çš„è¿‡ç¨‹ä»¥ç¤ºä¾‹çš„æ–¹å¼è¿›è¡Œå±•ç¤ºï¼Œå¯ä»¥æŸ¥çœ‹ä»£ç é‡Œé¢çš„æ³¨é‡Šã€‚\nå‚è€ƒï¼š\næ ‡å‡†åº“ tar ä¸­æ–‡æ–‡æ¡£\næ ‡å‡†åº“ tar å®˜æ–¹æ–‡æ¡£\nå•ä¸ªæ–‡ä»¶æ“ä½œ # è¿™ä¸ªéå¸¸ç®€å•ï¼Œå°±æ˜¯è¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿›è¡Œæ‰“åŒ…åŠè§£åŒ…æ“ä½œå³å¯ã€‚\nå•ä¸ªæ–‡ä»¶æ‰“åŒ… # ä» /etc/passwd ä¸‹å¤åˆ¶äº†ä¸€ä¸ª passwd æ–‡ä»¶åˆ°å½“å‰ç›®å½•ä¸‹ï¼Œç”¨æ¥åšå‹ç¼©æµ‹è¯•ã€‚ä»€ä¹ˆæ–‡ä»¶éƒ½æ˜¯å¯ä»¥çš„ï¼Œè‡ªå·±éšæ„å†™ä¸€ä¸ªä¹Ÿè¡Œã€‚è¿™é‡Œçš„ç¤ºä¾‹ä¸»è¦ä¸ºäº†è¯´æ˜ tar ï¼Œæ²¡æœ‰å¤„ç†è·¯å¾„ï¼Œæ‰€ä»¥è¿‡ç¨‹å…¨éƒ¨å‡è®¾æ˜¯åœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡Œã€‚\ncp /etc/passwd . å…³äºæ–‡ä»¶çš„æ‰“åŒ…ç›´æ¥æŸ¥çœ‹ç¤ºä¾‹ä»£ç ï¼Œå·²ç»åœ¨ç¤ºä¾‹ä»£ç ä¸­åšäº†è¯¦ç»†çš„æ³¨é‡Šã€‚\nç¤ºä¾‹ä»£ç ï¼ˆ pack_single_file.go ï¼‰ï¼š\npackage main import ( \u0026#34;os\u0026#34; \u0026#34;log\u0026#34; \u0026#34;archive/tar\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; ) func main() { // å‡†å¤‡æ‰“åŒ…çš„æºæ–‡ä»¶ var srcFile = \u0026#34;passwd\u0026#34; // æ‰“åŒ…åçš„æ–‡ä»¶ var desFile = fmt.Sprintf(\u0026#34;%s.tar\u0026#34;,srcFile) // éœ€è¦æ³¨æ„æ–‡ä»¶çš„æ‰“å¼€å³å…³é—­çš„é¡ºåºï¼Œå› ä¸º defer æ˜¯åå…¥å…ˆå‡ºï¼Œæ‰€ä»¥å…³é—­é¡ºåºå¾ˆé‡è¦ // ç¬¬ä¸€æ¬¡å†™è¿™ä¸ªç¤ºä¾‹çš„æ—¶å€™å°±æ²¡æ³¨æ„ï¼Œå¯¼è‡´å†™å®Œçš„ tar åŒ…ä¸å®Œæ•´ // ###### ç¬¬ 1 æ­¥ï¼Œå…ˆå‡†å¤‡å¥½ä¸€ä¸ª tar.Writer ç»“æ„ï¼Œç„¶åå†å‘é‡Œé¢å†™å…¥å†…å®¹ã€‚ ###### // åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œç”¨æ¥ä¿å­˜æ‰“åŒ…åçš„ passwd.tar æ–‡ä»¶ fw, err := os.Create(desFile) ErrPrintln(err) defer fw.Close() // é€šè¿‡ fw åˆ›å»ºä¸€ä¸ª tar.Writer tw := tar.NewWriter(fw) // è¿™é‡Œä¸è¦å¿˜è®°å…³é—­ï¼Œå¦‚æœä¸èƒ½æˆåŠŸå…³é—­ä¼šé€ æˆ tar åŒ…ä¸å®Œæ•´ // æ‰€ä»¥è¿™é‡Œåœ¨å…³é—­çš„åŒæ—¶è¿›è¡Œåˆ¤æ–­ï¼Œå¯ä»¥æ¸…æ¥šçš„çŸ¥é“æ˜¯å¦æˆåŠŸå…³é—­ defer func() { if err := tw.Close(); err != nil { ErrPrintln(err) } }() // ###### ç¬¬ 2 æ­¥ï¼Œå¤„ç†æ–‡ä»¶ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ tar.Header ç›¸å…³çš„ ###### // tar åŒ…å…±æœ‰ä¸¤éƒ¨åˆ†å†…å®¹ï¼šæ–‡ä»¶ä¿¡æ¯å’Œæ–‡ä»¶æ•°æ® // é€šè¿‡ Stat è·å– FileInfoï¼Œç„¶åé€šè¿‡ FileInfoHeader å¾—åˆ° hdr tar.*Header fi, err := os.Stat(srcFile) ErrPrintln(err) hdr, err := tar.FileInfoHeader(fi, \u0026#34;\u0026#34;) // å°† tar çš„æ–‡ä»¶ä¿¡æ¯ hdr å†™å…¥åˆ° tw err = tw.WriteHeader(hdr) ErrPrintln(err) // å°†æ–‡ä»¶æ•°æ®å†™å…¥ // æ‰“å¼€å‡†å¤‡å†™å…¥çš„æ–‡ä»¶ fr, err := os.Open(srcFile) ErrPrintln(err) defer fr.Close() written, err := io.Copy(tw, fr) ErrPrintln(err) log.Printf(\u0026#34;å…±å†™å…¥äº† %d ä¸ªå­—ç¬¦çš„æ•°æ®\\n\u0026#34;,written) } // å®šä¹‰ä¸€ä¸ªç”¨æ¥æ‰“å°çš„å‡½æ•°ï¼Œå°‘å†™ç‚¹ä»£ç ï¼Œå› ä¸ºè¦å¤„ç†å¾ˆå¤šæ¬¡çš„ err // åé¢å…¶ä»–ç¤ºä¾‹è¿˜ä¼šç»§ç»­ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œå°±ä¸å•ç‹¬å†å†™ï¼Œæœ›çœ‹åˆ°æ­¤å‡½æ•°äº†è§£ func ErrPrintln(err error) { if err != nil { log.Println(err) os.Exit(1) } } å•ä¸ªæ–‡ä»¶è§£åŒ… # è¿™ä¸ªä¹Ÿå¾ˆç®€å•ï¼ŒåŸºæœ¬ä¸Šå°†ä¸Šé¢è¿‡ç¨‹åè¿‡æ¥ï¼Œåªéœ€è¦å¤„ç† tar.Reader å³å¯ï¼Œè¯¦ç»†çš„æè¿°è§ç¤ºä¾‹ã€‚\nè¿™é‡Œå°±ç”¨åˆšåˆšæ‰“åŒ…çš„ passwd.tar æ–‡ä»¶åšç¤ºä¾‹ï¼Œå¦‚æœæ€•ç»“æœçœ‹ä¸å‡ºæ•ˆæœï¼Œå¯ä»¥å°†ä¹‹å‰ç”¨çš„ passwd æºæ–‡ä»¶åˆ é™¤ã€‚\nrm passwd ç¤ºä¾‹ä»£ç ï¼ˆ unpack_single_file.go ï¼‰ï¼š\npackage main import ( \u0026#34;os\u0026#34; \u0026#34;archive/tar\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; ) func main() { var srcFile = \u0026#34;passwd.tar\u0026#34; // å°† tar åŒ…æ‰“å¼€ fr, err := os.Open(srcFile) ErrPrintln(err) defer fr.Close() // é€šè¿‡ fr åˆ›å»ºä¸€ä¸ª tar.*Reader ç»“æ„ï¼Œç„¶åå°† tr éå†ï¼Œå¹¶å°†æ•°æ®ä¿å­˜åˆ°ç£ç›˜ä¸­ tr := tar.NewReader(fr) for hdr, err := tr.Next(); err != io.EOF; hdr, err = tr.Next(){ // å¤„ç† err ï¼= nil çš„æƒ…å†µ ErrPrintln(err) // è·å–æ–‡ä»¶ä¿¡æ¯ fi := hdr.FileInfo() // åˆ›å»ºä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œç”¨æ¥å†™å…¥è§£åŒ…åçš„æ•°æ® fw, err := os.Create(fi.Name()) ErrPrintln(err) // å°† tr å†™å…¥åˆ° fw n, err := io.Copy(fw, tr) ErrPrintln(err) log.Printf(\u0026#34;è§£åŒ…ï¼š %s åˆ° %s ï¼Œå…±å¤„ç†äº† %d ä¸ªå­—ç¬¦çš„æ•°æ®ã€‚\u0026#34;, srcFile,fi.Name(),n) // è®¾ç½®æ–‡ä»¶æƒé™ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å’ŒåŸå§‹æ–‡ä»¶æƒé™ç›¸åŒï¼Œå¦‚æœä¸è®¾ç½®ï¼Œä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„ umask æ¥è®¾ç½®ã€‚ os.Chmod(fi.Name(),fi.Mode().Perm()) // æ³¨æ„ï¼Œå› ä¸ºæ˜¯åœ¨å¾ªç¯ä¸­ï¼Œæ‰€ä»¥å°±æ²¡æœ‰ä½¿ç”¨ defer å…³é—­æ–‡ä»¶ // å¦‚æœæƒ³ä½¿ç”¨ defer çš„è¯ï¼Œå¯ä»¥å°†æ–‡ä»¶å†™å…¥çš„æ­¥éª¤å•ç‹¬å°è£…åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å³å¯ fw.Close() } } func ErrPrintln(err error){ if err != nil { log.Fatalln(err) os.Exit(1) } } æ“ä½œæ•´ä¸ªç›®å½• # æˆ‘ä»¬å®é™…ä¸­ tar å¾ˆå°‘ä¼šå»æ‰“åŒ…å•ä¸ªæ–‡ä»¶ï¼Œä¸€èˆ¬éƒ½æ˜¯æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼Œå¹¶ä¸”æ‰“åŒ…çš„æ—¶å€™é€šè¿‡ gzip æˆ–è€… bzip2 å‹ç¼©ã€‚\nå¦‚æœè¦æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼Œå¯ä»¥é€šè¿‡é€’å½’çš„æ–¹å¼æ¥å®ç°ã€‚è¿™é‡Œåªæ¼”ç¤ºäº† gzip æ–¹å¼å‹ç¼©ï¼Œè¿™ä¸ªå®ç°éå¸¸ç®€å•ï¼Œåªéœ€è¦åœ¨ fw å’Œ tw ä¹‹å‰åŠ ä¸Šä¸€å±‚å‹ç¼©å³å¯ï¼Œè¯¦æƒ…è§ç¤ºä¾‹ä»£ç ã€‚\nä¸ºäº†æµ‹è¯•æ‰“åŒ…æ•´ä¸ªç›®å½•ï¼Œå¤åˆ¶äº†ä¸€ä¸ª log ç›®å½•åˆ°å½“å‰è·¯å¾„ä¸‹ã€‚ä»€ä¹ˆç›®å½•å’Œæ–‡ä»¶éƒ½å¯ä»¥ï¼Œåªæ˜¯å› ä¸ºè¿™ä¸ªé‡Œé¢å†…å®¹æ¯”è¾ƒå¤šï¼Œå°±æ‹¿è¿™ä¸ªæ¥åšæµ‹è¯•äº†ã€‚\n# å‡ºç°æ²¡æœ‰æƒé™çš„é”™è¯¯ä¸ç”¨ç®¡å®ƒï¼Œå¤åˆ¶è¿‡æ¥å¤šå°‘æ˜¯å¤šå°‘å§ cp -r /var/log/ . è¯¦ç»†çš„æ“ä½œä¼šåœ¨æ³¨é‡Šä¸­è¯´æ˜ï¼Œä¸è¿‡åœ¨ä¹‹å‰å•æ–‡ä»¶ä¸­å‡ºç°è¿‡çš„æ­¥éª¤ä¸å†æ³¨é‡Šã€‚\næ‰“åŒ…å‹ç¼© # ç¤ºä¾‹ä»£ç ï¼ˆ targz.go ï¼‰ï¼š\npackage main import ( \u0026#34;archive/tar\u0026#34; \u0026#34;compress/gzip\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;log\u0026#34; \u0026#34;os\u0026#34; \u0026#34;path/filepath\u0026#34; \u0026#34;strings\u0026#34; ) func main() { // ä¿®æ”¹æ—¥å¿—æ ¼å¼ï¼Œæ˜¾ç¤ºå‡ºé”™ä»£ç çš„æ‰€åœ¨è¡Œï¼Œæ–¹ä¾¿è°ƒè¯•ï¼Œå®é™…é¡¹ç›®ä¸­ä¸€èˆ¬ä¸è®°å½•è¿™ä¸ªã€‚ var src = \u0026#34;apt\u0026#34; var dst = fmt.Sprintf(\u0026#34;%s.tar.gz\u0026#34;, src) // å°†æ­¥éª¤å†™å…¥äº†ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œè¿™æ ·å¤„ç†é”™è¯¯æ–¹ä¾¿ä¸€äº› if err := Tar(src, dst); err != nil { log.Fatalln(err) } } func Tar(src, dst string) (err error) { // åˆ›å»ºæ–‡ä»¶ fw, err := os.Create(dst) if err != nil { return } defer fw.Close() // å°† tar åŒ…ä½¿ç”¨ gzip å‹ç¼©ï¼Œå…¶å®æ·»åŠ å‹ç¼©åŠŸèƒ½å¾ˆç®€å•ï¼Œ // åªéœ€è¦åœ¨ fw å’Œ tw ä¹‹å‰åŠ ä¸Šä¸€å±‚å‹ç¼©å°±è¡Œäº†ï¼Œå’Œ Linux çš„ç®¡é“çš„æ„Ÿè§‰ç±»ä¼¼ gw := gzip.NewWriter(fw) defer gw.Close() // åˆ›å»º Tar.Writer ç»“æ„ tw := tar.NewWriter(gw) // å¦‚æœéœ€è¦å¯ç”¨ gzip å°†ä¸Šé¢ä»£ç æ³¨é‡Šï¼Œæ¢æˆä¸‹é¢çš„ defer tw.Close() // ä¸‹é¢å°±è¯¥å¼€å§‹å¤„ç†æ•°æ®äº†ï¼Œè¿™é‡Œçš„æ€è·¯å°±æ˜¯é€’å½’å¤„ç†ç›®å½•åŠç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶å’Œç›®å½• // è¿™é‡Œå¯ä»¥è‡ªå·±å†™ä¸ªé€’å½’æ¥å¤„ç†ï¼Œä¸è¿‡ Golang æä¾›äº† filepath.Walk å‡½æ•°ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„åšè¿™ä¸ªäº‹æƒ… // ç›´æ¥å°†è¿™ä¸ªå‡½æ•°çš„å¤„ç†ç»“æœè¿”å›å°±è¡Œï¼Œéœ€è¦ä¼ ç»™å®ƒä¸€ä¸ªæºæ–‡ä»¶æˆ–ç›®å½•ï¼Œå®ƒå°±å¯ä»¥è‡ªå·±å»å¤„ç† // æˆ‘ä»¬å°±åªéœ€è¦å»å®ç°æˆ‘ä»¬è‡ªå·±çš„ æ‰“åŒ…é€»è¾‘å³å¯ï¼Œä¸éœ€è¦å†å»è·¯å¾„ç›¸å…³çš„äº‹æƒ… return filepath.Walk(src, func(fileName string, fi os.FileInfo, err error) error { // å› ä¸ºè¿™ä¸ªé—­åŒ…ä¼šè¿”å›ä¸ª error ï¼Œæ‰€ä»¥å…ˆè¦å¤„ç†ä¸€ä¸‹è¿™ä¸ª if err != nil { return err } // è¿™é‡Œå°±ä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å† os.Stat äº†ï¼Œå®ƒå·²ç»åšå¥½äº†ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ fi å³å¯ hdr, err := tar.FileInfoHeader(fi, \u0026#34;\u0026#34;) if err != nil { return err } // è¿™é‡Œéœ€è¦å¤„ç†ä¸‹ hdr ä¸­çš„ Nameï¼Œå› ä¸ºé»˜è®¤æ–‡ä»¶çš„åå­—æ˜¯ä¸å¸¦è·¯å¾„çš„ï¼Œ // æ‰“åŒ…ä¹‹åæ‰€æœ‰æ–‡ä»¶å°±ä¼šå †åœ¨ä¸€èµ·ï¼Œè¿™æ ·å°±ç ´åäº†åŸæœ¬çš„ç›®å½•ç»“æœ // ä¾‹å¦‚ï¼š å°†åŸæœ¬ hdr.Name çš„ syslog æ›¿æ¢ç¨‹ log/syslog // è¿™ä¸ªå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œå›è°ƒå‡½æ•°çš„ fileName å­—æ®µç»™æˆ‘ä»¬è¿”å›æ¥çš„å°±æ˜¯å®Œæ•´è·¯å¾„çš„ log/syslog // strings.TrimPrefix å°† fileName çš„æœ€å·¦ä¾§çš„ / å»æ‰ï¼Œ // ç†Ÿæ‚‰ Linux çš„éƒ½çŸ¥é“ä¸ºä»€ä¹ˆè¦å»æ‰è¿™ä¸ª hdr.Name = strings.TrimPrefix(fileName, string(filepath.Separator)) // å†™å…¥æ–‡ä»¶ä¿¡æ¯ if err := tw.WriteHeader(hdr); err != nil { return err } // åˆ¤æ–­ä¸‹æ–‡ä»¶æ˜¯å¦æ˜¯æ ‡å‡†æ–‡ä»¶ï¼Œå¦‚æœä¸æ˜¯å°±ä¸å¤„ç†äº†ï¼Œ // å¦‚ï¼š ç›®å½•ï¼Œè¿™é‡Œå°±åªè®°å½•äº†æ–‡ä»¶ä¿¡æ¯ï¼Œä¸ä¼šæ‰§è¡Œä¸‹é¢çš„ copy if !fi.Mode().IsRegular() { return nil } // æ‰“å¼€æ–‡ä»¶ fr, err := os.Open(fileName) defer fr.Close() if err != nil { return err } // copy æ–‡ä»¶æ•°æ®åˆ° tw n, err := io.Copy(tw, fr) if err != nil { return err } // è®°å½•ä¸‹è¿‡ç¨‹ï¼Œè¿™ä¸ªå¯ä»¥ä¸è®°å½•ï¼Œè¿™ä¸ªçœ‹éœ€è¦ï¼Œè¿™æ ·å¯ä»¥çœ‹åˆ°æ‰“åŒ…çš„è¿‡ç¨‹ log.Printf(\u0026#34;æˆåŠŸæ‰“åŒ… %s ï¼Œå…±å†™å…¥äº† %d å­—èŠ‚çš„æ•°æ®\\n\u0026#34;, fileName, n) return nil }) } æ‰“åŒ…åŠå‹ç¼©å°±æå®šäº†ï¼Œä¸è¿‡è¿™ä¸ªä»£ç ç°åœ¨æˆ‘è¿˜å‘ç°æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸èƒ½å¤„ç†è½¯é“¾æ¥\nè§£åŒ…è§£å‹ # è¿™ä¸ªè¿‡ç¨‹åŸºæœ¬å°±æ˜¯æŠŠå‹ç¼©çš„è¿‡ç¨‹è¿”å›æ¥ï¼Œå¤šäº†äº›åˆ›å»ºç›®å½•çš„æ“ä½œ\npackage main import ( \u0026#34;archive/tar\u0026#34; \u0026#34;compress/gzip\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;io\u0026#34; \u0026#34;os\u0026#34; \u0026#34;path/filepath\u0026#34; ) func main() { var dst = \u0026#34;\u0026#34; // ä¸å†™å°±æ˜¯è§£å‹åˆ°å½“å‰ç›®å½• var src = \u0026#34;log.tar.gz\u0026#34; UnTar(dst, src) } func UnTar(dst, src string) (err error) { // æ‰“å¼€å‡†å¤‡è§£å‹çš„ tar åŒ… fr, err := os.Open(src) if err != nil { return } defer fr.Close() // å°†æ‰“å¼€çš„æ–‡ä»¶å…ˆè§£å‹ gr, err := gzip.NewReader(fr) if err != nil { return } defer gr.Close() // é€šè¿‡ gr åˆ›å»º tar.Reader tr := tar.NewReader(gr) // ç°åœ¨å·²ç»è·å¾—äº† tar.Reader ç»“æ„äº†ï¼Œåªéœ€è¦å¾ªç¯é‡Œé¢çš„æ•°æ®å†™å…¥æ–‡ä»¶å°±å¯ä»¥äº† for { hdr, err := tr.Next() switch { case err == io.EOF: return nil case err != nil: return err case hdr == nil: continue } // å¤„ç†ä¸‹ä¿å­˜è·¯å¾„ï¼Œå°†è¦ä¿å­˜çš„ç›®å½•åŠ ä¸Š header ä¸­çš„ Name // è¿™ä¸ªå˜é‡ä¿å­˜çš„æœ‰å¯èƒ½æ˜¯ç›®å½•ï¼Œæœ‰å¯èƒ½æ˜¯æ–‡ä»¶ï¼Œæ‰€ä»¥å°±å« FileDir äº†â€¦â€¦ dstFileDir := filepath.Join(dst, hdr.Name) // æ ¹æ® header çš„ Typeflag å­—æ®µï¼Œåˆ¤æ–­æ–‡ä»¶çš„ç±»å‹ switch hdr.Typeflag { case tar.TypeDir: // å¦‚æœæ˜¯ç›®å½•æ—¶å€™ï¼Œåˆ›å»ºç›®å½• // åˆ¤æ–­ä¸‹ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨å°±åˆ›å»º if b := ExistDir(dstFileDir); !b { // ä½¿ç”¨ MkdirAll ä¸ä½¿ç”¨ Mkdir ï¼Œå°±ç±»ä¼¼ Linux ç»ˆç«¯ä¸‹çš„ mkdir -pï¼Œ // å¯ä»¥é€’å½’åˆ›å»ºæ¯ä¸€çº§ç›®å½• if err := os.MkdirAll(dstFileDir, 0775); err != nil { return err } } case tar.TypeReg: // å¦‚æœæ˜¯æ–‡ä»¶å°±å†™å…¥åˆ°ç£ç›˜ // åˆ›å»ºä¸€ä¸ªå¯ä»¥è¯»å†™çš„æ–‡ä»¶ï¼Œæƒé™å°±ä½¿ç”¨ header ä¸­è®°å½•çš„æƒé™ // å› ä¸ºæ“ä½œç³»ç»Ÿçš„ FileMode æ˜¯ int32 ç±»å‹çš„ï¼Œhdr ä¸­çš„æ˜¯ int64ï¼Œæ‰€ä»¥è½¬æ¢ä¸‹ file, err := os.OpenFile(dstFileDir, os.O_CREATE|os.O_RDWR, os.FileMode(hdr.Mode)) if err != nil { return err } n, err := io.Copy(file, tr) if err != nil { return err } // å°†è§£å‹ç»“æœè¾“å‡ºæ˜¾ç¤º fmt.Printf(\u0026#34;æˆåŠŸè§£å‹ï¼š %s , å…±å¤„ç†äº† %d ä¸ªå­—ç¬¦\\n\u0026#34;, dstFileDir, n) // ä¸è¦å¿˜è®°å…³é—­æ‰“å¼€çš„æ–‡ä»¶ï¼Œå› ä¸ºå®ƒæ˜¯åœ¨ for å¾ªç¯ä¸­ï¼Œä¸èƒ½ä½¿ç”¨ defer // å¦‚æœæƒ³ä½¿ç”¨ defer å°±æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ file.Close() } } return nil } // åˆ¤æ–­ç›®å½•æ˜¯å¦å­˜åœ¨ func ExistDir(dirname string) bool { fi, err := os.Stat(dirname) return (err == nil || os.IsExist(err)) \u0026amp;\u0026amp; fi.IsDir() } åˆ°è¿™é‡Œè§£å‹å°±å®Œæˆäº†ï¼Œåªæ˜¯ä¸€ä¸ªå®éªŒä»£ç ï¼Œè¿˜æœ‰å¾ˆå¤šä¸å®Œå–„çš„åœ°æ–¹ï¼Œæ¬¢è¿æå‡ºå®è´µçš„æ„è§ã€‚\n","date":"15 July 2023","permalink":"/python/python-blog/","section":"Pythons","summary":"This is title # è¿™ä¸ªåŒ…æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å°†æ–‡ä»¶è¿›è¡Œæ‰“åŒ…å’Œè§£åŒ…ï¼Œè¦æ˜¯ç†Ÿæ‚‰ Linux ä¸‹çš„ tar å‘½ä»¤è¿™ä¸ªå°±å¾ˆå¥½ç†è§£äº†ã€‚ ä¸»è¦æ˜¯é€šè¿‡ tar.","title":"Python åšå®¢ç¬¬ä¸€ç¯‡"},{"content":"","date":"15 July 2023","permalink":"/python/","section":"Pythons","summary":"","title":"Pythons"},{"content":"","date":"15 July 2023","permalink":"/tags/","section":"Tags","summary":"","title":"Tags"},{"content":"","date":"15 July 2023","permalink":"/tags/yun/","section":"Tags","summary":"","title":"yun"},{"content":"","date":"1 January 0001","permalink":"/authors/","section":"Authors","summary":"","title":"Authors"},{"content":"","date":"1 January 0001","permalink":"/categories/","section":"Categories","summary":"","title":"Categories"},{"content":"","date":"1 January 0001","permalink":"/series/","section":"Series","summary":"","title":"Series"}]